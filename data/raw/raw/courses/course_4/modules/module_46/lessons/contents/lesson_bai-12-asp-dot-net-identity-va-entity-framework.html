<h1>ğŸ§© BÃ€I 12 â€“ ASP.NET IDENTITY &amp; ENTITY FRAMEWORK</h1><h2>ğŸ¯ Má»¥c tiÃªu há»c táº­p</h2><ul><li>Hiá»ƒu cÆ¡ cháº¿ xÃ¡c thá»±c ngÆ°á»i dÃ¹ng vá»›i ASP.NET Identity.</li><li>CÃ i Ä‘áº·t há»‡ thá»‘ng Ä‘Äƒng kÃ½, Ä‘Äƒng nháº­p, Ä‘Äƒng xuáº¥t báº±ng Identity.</li><li>Hiá»ƒu má»‘i quan há»‡ giá»¯a Identity vÃ  Entity Framework Core.</li><li>Thá»±c hÃ nh táº¡o database lÆ°u tÃ i khoáº£n, vai trÃ² vÃ  phÃ¢n quyá»n ngÆ°á»i dÃ¹ng.</li></ul><hr><h2>1. ASP.NET Identity lÃ  gÃ¬?</h2><p><b>ASP.NET Identity</b> lÃ  framework quáº£n lÃ½ tÃ i khoáº£n ngÆ°á»i dÃ¹ng Ä‘Æ°á»£c tÃ­ch há»£p sáºµn trong ASP.NET Core.</p><p>Chá»©c nÄƒng chÃ­nh:</p><ul><li>ÄÄƒng kÃ½, Ä‘Äƒng nháº­p, Ä‘Äƒng xuáº¥t.</li><li>PhÃ¢n quyá»n theo Role hoáº·c Claim.</li><li>Quáº£n lÃ½ máº­t kháº©u, Ä‘á»•i máº­t kháº©u, xÃ¡c thá»±c email, v.v.</li><li>TÃ­ch há»£p trá»±c tiáº¿p vá»›i <b>Entity Framework Core</b> Ä‘á»ƒ lÆ°u dá»¯ liá»‡u ngÆ°á»i dÃ¹ng.</li></ul><hr><h2>2. Cáº¥u trÃºc cÆ¡ sá»Ÿ dá»¯ liá»‡u Identity</h2><p>Khi cháº¡y Identity, EF Core sáº½ tá»± táº¡o cÃ¡c báº£ng:</p><pre><code>AspNetUsersAspNetRolesAspNetUserRolesAspNetUserClaimsAspNetRoleClaimsAspNetUserLoginsAspNetUserTokens</code></pre><p>Má»—i ngÆ°á»i dÃ¹ng lÃ  má»™t báº£n ghi trong <b>AspNetUsers</b>, liÃªn káº¿t vá»›i Role qua <b>AspNetUserRoles</b>.</p><hr><h2>3. CÃ i Ä‘áº·t Identity trong ASP.NET Core</h2><p>Trong <b>Program.cs</b>:</p><pre><code>using Microsoft.AspNetCore.Identity;using Microsoft.EntityFrameworkCore;using WebIdentity.Data;var builder = WebApplication.CreateBuilder(args);// Káº¿t ná»‘i CSDLbuilder.Services.AddDbContext&lt;AppDbContext&gt;(options =&gt;    options.UseSqlServer(builder.Configuration.GetConnectionString("DefaultConnection")));// Cáº¥u hÃ¬nh Identitybuilder.Services.AddIdentity&lt;IdentityUser, IdentityRole&gt;()    .AddEntityFrameworkStores&lt;AppDbContext&gt;()    .AddDefaultTokenProviders();builder.Services.ConfigureApplicationCookie(options =&gt;{    options.LoginPath = "/Account/Login";    options.AccessDeniedPath = "/Account/AccessDenied";});builder.Services.AddControllersWithViews();var app = builder.Build();app.UseAuthentication();app.UseAuthorization();app.MapDefaultControllerRoute();app.Run();</code></pre><hr><h2>4. Táº¡o DbContext</h2><pre><code>using Microsoft.AspNetCore.Identity.EntityFrameworkCore;using Microsoft.EntityFrameworkCore;namespace WebIdentity.Data{    public class AppDbContext : IdentityDbContext&lt;IdentityUser&gt;    {        public AppDbContext(DbContextOptions&lt;AppDbContext&gt; options)            : base(options) { }    }}</code></pre><hr><h2>5. Táº¡o trang Ä‘Äƒng kÃ½ (Register)</h2><pre><code>public class AccountController : Controller{    private readonly UserManager&lt;IdentityUser&gt; _userManager;    private readonly SignInManager&lt;IdentityUser&gt; _signInManager;    public AccountController(UserManager&lt;IdentityUser&gt; userManager,                             SignInManager&lt;IdentityUser&gt; signInManager)    {        _userManager = userManager;        _signInManager = signInManager;    }    [HttpGet]    public IActionResult Register() =&gt; View();    [HttpPost]    public async Task&lt;IActionResult&gt; Register(string email, string password)    {        var user = new IdentityUser { UserName = email, Email = email };        var result = await _userManager.CreateAsync(user, password);        if (result.Succeeded)        {            await _signInManager.SignInAsync(user, isPersistent: false);            return RedirectToAction("Index", "Home");        }        foreach (var err in result.Errors)            ModelState.AddModelError("", err.Description);        return View();    }}</code></pre><h3>View Register.cshtml</h3><pre><code>@{    ViewData["Title"] = "ÄÄƒng kÃ½ tÃ i khoáº£n";}&lt;h2&gt;@ViewData["Title"]&lt;/h2&gt;&lt;form asp-action="Register" method="post"&gt;  &lt;label&gt;Email&lt;/label&gt;  &lt;input type="email" name="email" class="form-control" /&gt;  &lt;label&gt;Máº­t kháº©u&lt;/label&gt;  &lt;input type="password" name="password" class="form-control" /&gt;  &lt;button type="submit" class="btn btn-success mt-3"&gt;ÄÄƒng kÃ½&lt;/button&gt;&lt;/form&gt;</code></pre><hr><h2>6. ÄÄƒng nháº­p (Login)</h2><pre><code>[HttpGet]public IActionResult Login() =&gt; View();[HttpPost]public async Task&lt;IActionResult&gt; Login(string email, string password){    var result = await _signInManager.PasswordSignInAsync(email, password, false, false);    if (result.Succeeded)        return RedirectToAction("Index", "Home");    ModelState.AddModelError("", "Sai tÃ i khoáº£n hoáº·c máº­t kháº©u!");    return View();}</code></pre><hr><h2>7. ÄÄƒng xuáº¥t</h2><pre><code>public async Task Logout(){    await _signInManager.SignOutAsync();    return RedirectToAction("Login");}</code></pre><hr><h2>8. PhÃ¢n quyá»n theo Role</h2><pre><code>// Táº¡o role má»›i (cháº¡y 1 láº§n)await _roleManager.CreateAsync(new IdentityRole("Admin"));// GÃ¡n user vÃ o rolevar user = await _userManager.FindByEmailAsync("admin@gmail.com");await _userManager.AddToRoleAsync(user, "Admin");// Chá»‰ cho phÃ©p Admin truy cáº­p:[Authorize(Roles = "Admin")]public IActionResult Dashboard() =&gt; View();</code></pre><hr><h2>9. Hiá»ƒn thá»‹ ngÆ°á»i dÃ¹ng Ä‘ang Ä‘Äƒng nháº­p</h2><pre><code>@if (User.Identity.IsAuthenticated){    &lt;p&gt;Xin chÃ o, @User.Identity.Name&lt;/p&gt;    &lt;a asp-controller="Account" asp-action="Logout"&gt;ÄÄƒng xuáº¥t&lt;/a&gt;}else{    &lt;a asp-controller="Account" asp-action="Login"&gt;ÄÄƒng nháº­p&lt;/a&gt;}</code></pre><hr><h2>10. Æ¯u Ä‘iá»ƒm cá»§a ASP.NET Identity</h2><ul><li>TÃ­ch há»£p sáºµn vá»›i EF Core, tá»± Ä‘á»™ng táº¡o báº£ng ngÆ°á»i dÃ¹ng vÃ  vai trÃ².</li><li>Há»— trá»£ xÃ¡c thá»±c nÃ¢ng cao (email, 2FA, token).</li><li>Tuá»³ biáº¿n dá»… dÃ ng: má»Ÿ rá»™ng IdentityUser, thÃªm thuá»™c tÃ­nh (FullName, Phone,...).</li><li>Äáº£m báº£o báº£o máº­t cao (bÄƒm máº­t kháº©u, lockout, token reset).</li></ul><hr><h2>ğŸ§  BÃ i táº­p thá»±c hÃ nh</h2><ol><li>Táº¡o project ASP.NET Core MVC vÃ  cÃ i Ä‘áº·t Identity vá»›i SQL Server.</li><li>Táº¡o tÃ i khoáº£n ngÆ°á»i dÃ¹ng vÃ  lÆ°u trong database.</li><li>ThÃªm chá»©c nÄƒng Ä‘Äƒng nháº­p, Ä‘Äƒng kÃ½, Ä‘Äƒng xuáº¥t.</li><li>Táº¡o vai trÃ² Admin vÃ  gÃ¡n ngÆ°á»i dÃ¹ng vÃ o role.</li><li>Báº£o vá»‡ trang /Admin chá»‰ cho phÃ©p Role = Admin.</li></ol><hr><h2>âœ… Tá»•ng káº¿t</h2><ul><li>ASP.NET Identity giÃºp quáº£n lÃ½ tÃ i khoáº£n ngÆ°á»i dÃ¹ng chuyÃªn nghiá»‡p.</li><li>TÃ­ch há»£p Entity Framework Ä‘á»ƒ lÆ°u dá»¯ liá»‡u vÃ  phÃ¢n quyá»n.</li><li>Náº¯m Ä‘Æ°á»£c quy trÃ¬nh Ä‘Äƒng nháº­p, Ä‘Äƒng kÃ½, vÃ  phÃ¢n quyá»n theo Role.</li><li>LÃ  ná»n táº£ng Ä‘á»ƒ má»Ÿ rá»™ng thÃ nh há»‡ thá»‘ng xÃ¡c thá»±c báº±ng JWT, Google, Facebook, v.v.</li></ul>