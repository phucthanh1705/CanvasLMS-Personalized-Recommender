{
  "title": "BÃ€I 9 â€“ BáºªY Lá»–I (TRIGGER)",
  "created_at": "2025-10-26T10:10:10Z",
  "url": "bai-9-bay-loi-trigger",
  "editing_roles": "teachers",
  "page_id": 329,
  "last_edited_by": {
    "id": 1,
    "anonymous_id": "1",
    "display_name": "admin@gmail.com",
    "avatar_image_url": "http://localhost:3000/images/messages/avatar-50.png",
    "html_url": "http://localhost:3000/courses/4/users/1",
    "pronouns": null
  },
  "published": true,
  "hide_from_students": false,
  "front_page": false,
  "html_url": "http://localhost:3000/courses/4/pages/bai-9-bay-loi-trigger",
  "todo_date": null,
  "publish_at": null,
  "updated_at": "2025-10-26T10:10:24Z",
  "locked_for_user": false,
  "body": "<h1>ğŸ“˜ BÃ€I 9 â€“ BáºªY Lá»–I (TRIGGER)</h1><h2>ğŸ¯ Má»¥c tiÃªu há»c táº­p</h2><ul><li>Hiá»ƒu rÃµ khÃ¡i niá»‡m vÃ  vai trÃ² cá»§a Trigger (báº«y lá»—i) trong cÆ¡ sá»Ÿ dá»¯ liá»‡u.</li><li>PhÃ¢n biá»‡t cÃ¡c loáº¡i Trigger: AFTER, INSTEAD OF, BEFORE.</li><li>Náº¯m Ä‘Æ°á»£c cÃ¡ch táº¡o, sá»­a, xÃ³a Trigger trong SQL Server.</li><li>Biáº¿t á»©ng dá»¥ng Trigger trong kiá»ƒm tra rÃ ng buá»™c, tá»± Ä‘á»™ng cáº­p nháº­t hoáº·c ghi log thay Ä‘á»•i dá»¯ liá»‡u.</li></ul><hr><h2>9.1 KHÃI NIá»†M Vá»€ TRIGGER</h2><p><b>Trigger</b> lÃ  má»™t loáº¡i thá»§ tá»¥c Ä‘áº·c biá»‡t Ä‘Æ°á»£c tá»± Ä‘á»™ng thá»±c thi khi cÃ³ sá»± kiá»‡n xáº£y ra trÃªn báº£ng (INSERT, UPDATE, DELETE). NÃ³ thÆ°á»ng dÃ¹ng Ä‘á»ƒ kiá»ƒm tra tÃ­nh há»£p lá»‡, ghi lá»‹ch sá»­ thay Ä‘á»•i, hoáº·c tá»± Ä‘á»™ng cáº­p nháº­t dá»¯ liá»‡u liÃªn quan.</p><p><b>VÃ­ dá»¥:</b> Khi thÃªm sinh viÃªn má»›i, há»‡ thá»‘ng tá»± Ä‘á»™ng ghi log vÃ o báº£ng LichSuThemSV.</p><hr><h2>9.2 PHÃ‚N LOáº I TRIGGER</h2><h3>9.2.1 AFTER Trigger</h3><p>Thá»±c thi sau khi hÃ nh Ä‘á»™ng (INSERT, UPDATE, DELETE) hoÃ n táº¥t thÃ nh cÃ´ng.</p><p><b>VÃ­ dá»¥:</b></p><pre>CREATE TRIGGER trg_AfterInsertSV<br>ON SinhVien<br>AFTER INSERT<br>AS<br>BEGIN<br>INSERT INTO Log_SinhVien(MaSV, ThoiGian, HanhDong)<br>SELECT MaSV, GETDATE(), 'INSERT' FROM inserted;<br>END;</pre><h3>9.2.2 INSTEAD OF Trigger</h3><p>Thá»±c thi thay cho hÃ nh Ä‘á»™ng gá»‘c (vÃ­ dá»¥: thay vÃ¬ DELETE thÃ¬ Trigger xá»­ lÃ½ riÃªng).</p><p><b>VÃ­ dá»¥:</b></p><pre>CREATE TRIGGER trg_InsteadOfDelete<br>ON SinhVien<br>INSTEAD OF DELETE<br>AS<br>BEGIN<br>INSERT INTO Log_SinhVien(MaSV, ThoiGian, HanhDong)<br>SELECT MaSV, GETDATE(), 'DELETE_ATTEMPT' FROM deleted;<br>PRINT 'KhÃ´ng Ä‘Æ°á»£c phÃ©p xÃ³a sinh viÃªn';<br>END;</pre><h3>9.2.3 BEFORE Trigger (chá»§ yáº¿u trong MySQL)</h3><p>Cháº¡y trÆ°á»›c khi thao tÃ¡c dá»¯ liá»‡u diá»…n ra, giÃºp kiá»ƒm tra hoáº·c chá»‰nh sá»­a dá»¯ liá»‡u Ä‘áº§u vÃ o.</p><hr><h2>9.3 NGUYÃŠN Táº®C HOáº T Äá»˜NG Cá»¦A TRIGGER</h2><ul><li>Trigger khÃ´ng Ä‘Æ°á»£c gá»i trá»±c tiáº¿p báº±ng lá»‡nh EXEC mÃ  Ä‘Æ°á»£c tá»± Ä‘á»™ng kÃ­ch hoáº¡t.</li><li>SQL Server cung cáº¥p hai báº£ng áº£o: <b>inserted</b> vÃ  <b>deleted</b>.</li><li>Báº£ng <b>inserted</b> chá»©a cÃ¡c báº£n ghi má»›i thÃªm hoáº·c cáº­p nháº­t.</li><li>Báº£ng <b>deleted</b> chá»©a cÃ¡c báº£n ghi bá»‹ xÃ³a hoáº·c trÆ°á»›c khi cáº­p nháº­t.</li></ul><hr><h2>9.4 CÃš PHÃP Táº O TRIGGER</h2><pre>CREATE TRIGGER TenTrigger<br>ON TenBang<br>AFTER | INSTEAD OF [INSERT|UPDATE|DELETE]<br>AS<br>BEGIN<br>    -- Ná»™i dung Trigger<br>END;</pre><p><b>XÃ³a Trigger:</b> DROP TRIGGER TenTrigger;</p><p><b>Sá»­a Trigger:</b> ALTER TRIGGER TenTrigger ON TenBang ...;</p><hr><h2>9.5 á»¨NG Dá»¤NG Cá»¦A TRIGGER</h2><ul><li><b>Kiá»ƒm tra dá»¯ liá»‡u tá»± Ä‘á»™ng:</b> NgÄƒn viá»‡c nháº­p dá»¯ liá»‡u khÃ´ng há»£p lá»‡.</li><li><b>Äá»“ng bá»™ dá»¯ liá»‡u:</b> Cáº­p nháº­t báº£ng liÃªn quan khi dá»¯ liá»‡u thay Ä‘á»•i.</li><li><b>Ghi log:</b> LÆ°u lá»‹ch sá»­ thay Ä‘á»•i (ai, khi nÃ o, hÃ nh Ä‘á»™ng gÃ¬).</li><li><b>Giá»›i háº¡n thao tÃ¡c:</b> KhÃ´ng cho phÃ©p xÃ³a hoáº·c sá»­a dá»¯ liá»‡u quan trá»ng.</li></ul><hr><h2>9.6 PHÃ‚N LOáº I THEO Sá»° KIá»†N</h2><ul><li><b>AFTER INSERT</b> â€“ cháº¡y sau khi thÃªm dá»¯ liá»‡u.</li><li><b>AFTER UPDATE</b> â€“ cháº¡y sau khi cáº­p nháº­t dá»¯ liá»‡u.</li><li><b>AFTER DELETE</b> â€“ cháº¡y sau khi xÃ³a dá»¯ liá»‡u.</li><li><b>INSTEAD OF DELETE</b> â€“ thay tháº¿ hÃ nh Ä‘á»™ng xÃ³a.</li></ul><hr><h2>9.7 Æ¯U VÃ€ NHÆ¯á»¢C ÄIá»‚M</h2><h3>Æ¯u Ä‘iá»ƒm</h3><ul><li>Tá»± Ä‘á»™ng hÃ³a kiá»ƒm tra vÃ  cáº­p nháº­t dá»¯ liá»‡u.</li><li>TÄƒng tÃ­nh toÃ n váº¹n vÃ  báº£o máº­t dá»¯ liá»‡u.</li><li>Giáº£m lá»—i thao tÃ¡c tá»« ngÆ°á»i dÃ¹ng.</li></ul><h3>NhÆ°á»£c Ä‘iá»ƒm</h3><ul><li>KhÃ³ debug, khÃ³ kiá»ƒm soÃ¡t logic phá»©c táº¡p.</li><li>CÃ³ thá»ƒ lÃ m giáº£m hiá»‡u nÄƒng khi cháº¡y trÃªn báº£ng lá»›n.</li><li>Dá»… gÃ¢y vÃ²ng láº·p vÃ´ háº¡n náº¿u gá»i láº«n nhau giá»¯a cÃ¡c Trigger.</li></ul><hr><h2>âœ… Ghi nhá»› nhanh</h2><ul><li>Trigger lÃ  thá»§ tá»¥c tá»± Ä‘á»™ng kÃ­ch hoáº¡t khi cÃ³ thao tÃ¡c dá»¯ liá»‡u.</li><li>CÃ³ thá»ƒ dÃ¹ng Ä‘á»ƒ kiá»ƒm tra, ghi log hoáº·c cháº·n thao tÃ¡c nguy hiá»ƒm.</li><li>KhÃ´ng nÃªn láº¡m dá»¥ng Trigger vÃ¬ áº£nh hÆ°á»Ÿng hiá»‡u nÄƒng.</li><li>Báº£ng áº£o <b>inserted</b> vÃ  <b>deleted</b> giÃºp theo dÃµi thay Ä‘á»•i trong Trigger.</li></ul>"
}