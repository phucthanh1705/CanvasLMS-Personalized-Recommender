<h1>üß© B√ÄI 07 ‚Äì C√ÇU L·ªÜNH TRUY V·∫§N N√ÇNG CAO TRONG SQL</h1><h2>üéØ M·ª•c ti√™u h·ªçc t·∫≠p</h2><ul><li>Hi·ªÉu v√† s·ª≠ d·ª•ng th√†nh th·∫°o c√°c truy v·∫•n n√¢ng cao nh∆∞ JOIN, SUBQUERY, VIEW, v√† CTE.</li><li>√Åp d·ª•ng c√°c h√†m t·ªïng h·ª£p, ƒëi·ªÅu ki·ªán logic ph·ª©c t·∫°p v√† bi·ªÉu th·ª©c con ƒë·ªÉ gi·∫£i quy·∫øt b√†i to√°n th·ª±c t·∫ø.</li><li>Bi·∫øt c√°ch t·ªëi ∆∞u truy v·∫•n, tr√°nh l·∫∑p d·ªØ li·ªáu v√† tƒÉng hi·ªáu nƒÉng h·ªá th·ªëng.</li><li>Th·ª±c h√†nh k·∫øt h·ª£p nhi·ªÅu b·∫£ng v√† vi·∫øt truy v·∫•n ƒëa c·∫•p trong c√°c b√†i to√°n qu·∫£n l√Ω d·ªØ li·ªáu th·ª±c t·∫ø.</li></ul><hr><h2>1. PH√âP K·∫æT (JOIN) TRONG SQL</h2><p>JOIN d√πng ƒë·ªÉ k·∫øt h·ª£p d·ªØ li·ªáu t·ª´ nhi·ªÅu b·∫£ng d·ª±a tr√™n ƒëi·ªÅu ki·ªán li√™n k·∫øt. ƒê√¢y l√† k·ªπ thu·∫≠t quan tr·ªçng trong truy v·∫•n d·ªØ li·ªáu quan h·ªá.</p><h3>1.1 INNER JOIN</h3><p>L·∫•y c√°c b·∫£n ghi c√≥ gi√° tr·ªã tr√πng kh·ªõp ·ªü c·∫£ hai b·∫£ng.</p><pre><code>SELECT sv.HoTen, mh.TenMH, dk.Diem<br>FROM SinhVien sv<br>INNER JOIN DangKy dk ON sv.MaSV = dk.MaSV<br>INNER JOIN MonHoc mh ON dk.MaMH = mh.MaMH;</code></pre><h3>1.2 LEFT JOIN v√† RIGHT JOIN</h3><ul><li><b>LEFT JOIN:</b> L·∫•y t·∫•t c·∫£ b·∫£n ghi c·ªßa b·∫£ng b√™n tr√°i v√† ph·∫ßn kh·ªõp b√™n ph·∫£i (n·∫øu c√≥).</li><li><b>RIGHT JOIN:</b> L·∫•y t·∫•t c·∫£ b·∫£n ghi c·ªßa b·∫£ng b√™n ph·∫£i v√† ph·∫ßn kh·ªõp b√™n tr√°i (n·∫øu c√≥).</li></ul><pre><code>SELECT sv.HoTen, dk.Diem<br>FROM SinhVien sv<br>LEFT JOIN DangKy dk ON sv.MaSV = dk.MaSV;</code></pre><h3>1.3 FULL OUTER JOIN</h3><p>L·∫•y t·∫•t c·∫£ b·∫£n ghi t·ª´ c·∫£ hai b·∫£ng, n·∫øu kh√¥ng kh·ªõp th√¨ hi·ªÉn th·ªã NULL.</p><hr><h2>2. TRUY V·∫§N L·ªíNG (SUBQUERY)</h2><p>Truy v·∫•n l·ªìng (Subquery) l√† c√¢u truy v·∫•n ƒë∆∞·ª£c ƒë·∫∑t b√™n trong c√¢u truy v·∫•n kh√°c ƒë·ªÉ l·ªçc ho·∫∑c t√≠nh to√°n d·ªØ li·ªáu.</p><pre><code>SELECT HoTen, Diem<br>FROM SinhVien<br>WHERE Diem &gt; (SELECT AVG(Diem) FROM SinhVien);</code></pre><h3>2.1 Subquery trong FROM</h3><pre><code>SELECT Lop, AVG(DiemTB) FROM (<br>SELECT MaLop AS Lop, AVG(Diem) AS DiemTB<br>FROM DangKy GROUP BY MaLop) AS T<br>GROUP BY Lop;</code></pre><h3>2.2 Subquery trong SELECT</h3><pre><code>SELECT MaSV, (SELECT COUNT(*) FROM DangKy dk WHERE dk.MaSV = sv.MaSV) AS SoMonHoc FROM SinhVien sv;</code></pre><hr><h2>3. VIEW (KHUNG NH√åN)</h2><p>VIEW l√† b·∫£ng ·∫£o ƒë∆∞·ª£c t·∫°o t·ª´ k·∫øt qu·∫£ truy v·∫•n, gi√∫p ƒë∆°n gi·∫£n h√≥a truy v·∫•n ph·ª©c t·∫°p v√† b·∫£o m·∫≠t d·ªØ li·ªáu.</p><pre><code>CREATE VIEW v_DiemSinhVien AS<br>SELECT sv.MaSV, sv.HoTen, mh.TenMH, dk.Diem<br>FROM SinhVien sv<br>JOIN DangKy dk ON sv.MaSV = dk.MaSV<br>JOIN MonHoc mh ON dk.MaMH = mh.MaMH;</code></pre><p><b>L·ª£i √≠ch:</b> Gi·∫£m ph·ª©c t·∫°p, tƒÉng b·∫£o m·∫≠t, d·ªÖ t√°i s·ª≠ d·ª•ng truy v·∫•n.</p><hr><h2>4. CTE (COMMON TABLE EXPRESSION)</h2><p>CTE l√† ph·∫ßn truy v·∫•n t·∫°m ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a b·∫±ng WITH, c√≥ th·ªÉ t√°i s·ª≠ d·ª•ng trong truy v·∫•n ch√≠nh.</p><pre><code>WITH DiemTB AS (<br>SELECT MaSV, AVG(Diem) AS TB FROM DangKy GROUP BY MaSV)<br>SELECT MaSV, TB FROM DiemTB WHERE TB &gt; 8;</code></pre><p><b>Kh√°c v·ªõi VIEW:</b> CTE ch·ªâ t·ªìn t·∫°i trong ph·∫°m vi truy v·∫•n hi·ªán t·∫°i.</p><hr><h2>5. TRUY V·∫§N PH√ÇN T√çCH (AGGREGATE V√Ä WINDOW FUNCTION)</h2><ul><li><b>Aggregate Functions:</b> SUM, AVG, COUNT, MAX, MIN.</li><li><b>Window Functions:</b> Cho ph√©p t√≠nh to√°n tr√™n m·ªôt ph·∫°m vi d√≤ng m√† kh√¥ng gom nh√≥m d·ªØ li·ªáu.</li></ul><pre><code>SELECT MaSV, Diem, RANK() OVER(ORDER BY Diem DESC) AS XepHang FROM DangKy;</code></pre><hr><h2>‚úÖ T·ªîNG K·∫æT</h2><ul><li>JOIN gi√∫p k·∫øt h·ª£p d·ªØ li·ªáu gi·ªØa c√°c b·∫£ng d·ª±a tr√™n kh√≥a.</li><li>Subquery v√† CTE cho ph√©p vi·∫øt truy v·∫•n ƒëa t·∫ßng, t·ªëi ∆∞u h∆°n khi x·ª≠ l√Ω d·ªØ li·ªáu ph·ª©c t·∫°p.</li><li>VIEW gi√∫p b·∫£o m·∫≠t v√† t√°i s·ª≠ d·ª•ng truy v·∫•n hi·ªáu qu·∫£.</li><li>Hi·ªÉu r√µ c√°c h√†m ph√¢n t√≠ch gi√∫p t·ªëi ∆∞u truy v·∫•n th·ªëng k√™, x·∫øp h·∫°ng v√† t·ªïng h·ª£p d·ªØ li·ªáu.</li></ul>