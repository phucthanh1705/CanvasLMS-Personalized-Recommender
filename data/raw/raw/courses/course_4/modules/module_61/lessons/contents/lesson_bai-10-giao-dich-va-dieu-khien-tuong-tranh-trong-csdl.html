<h1>ğŸ§© BÃ€I 10 â€“ GIAO Dá»ŠCH VÃ€ ÄIá»€U KHIá»‚N TÆ¯Æ NG TRANH TRONG CSDL</h1><h2>ğŸ¯ Má»¥c tiÃªu há»c táº­p</h2><ul><li>Hiá»ƒu rÃµ khÃ¡i niá»‡m giao dá»‹ch (transaction) vÃ  Ä‘áº·c tÃ­nh ACID trong cÆ¡ sá»Ÿ dá»¯ liá»‡u.</li><li>PhÃ¢n biá»‡t cÃ¡c má»©c cÃ´ láº­p (isolation level) vÃ  cÃ¡c váº¥n Ä‘á» tÆ°Æ¡ng tranh.</li><li>Náº¯m Ä‘Æ°á»£c cÆ¡ cháº¿ khÃ³a (locking), rollback, commit vÃ  cÃ¡ch quáº£n lÃ½ song song hiá»‡u quáº£.</li><li>Hiá»ƒu vÃ  Ã¡p dá»¥ng ká»¹ thuáº­t kiá»ƒm soÃ¡t tÆ°Æ¡ng tranh (concurrency control) Ä‘á»ƒ Ä‘áº£m báº£o tÃ­nh toÃ n váº¹n dá»¯ liá»‡u.</li></ul><hr><h2>1. KHÃI NIá»†M GIAO Dá»ŠCH</h2><p>Giao dá»‹ch lÃ  má»™t táº­p há»£p cÃ¡c thao tÃ¡c trÃªn cÆ¡ sá»Ÿ dá»¯ liá»‡u Ä‘Æ°á»£c thá»±c hiá»‡n nhÆ° má»™t Ä‘Æ¡n vá»‹ logic duy nháº¥t. Náº¿u má»™t pháº§n tháº¥t báº¡i, toÃ n bá»™ giao dá»‹ch pháº£i bá»‹ há»§y Ä‘á»ƒ Ä‘áº£m báº£o tÃ­nh nháº¥t quÃ¡n dá»¯ liá»‡u.</p><pre><code>BEGIN TRANSACTION;<br>UPDATE TaiKhoan SET SoDu = SoDu - 100000 WHERE MaTK = 'A';<br>UPDATE TaiKhoan SET SoDu = SoDu + 100000 WHERE MaTK = 'B';<br>COMMIT;</code></pre><p>Hoáº·c náº¿u xáº£y ra lá»—i:</p><pre><code>ROLLBACK;</code></pre><hr><h2>2. Äáº¶C TÃNH ACID Cá»¦A GIAO Dá»ŠCH</h2><ul><li><b>Atomicity (TÃ­nh nguyÃªn tá»­):</b> ToÃ n bá»™ cÃ¡c thao tÃ¡c trong giao dá»‹ch Ä‘Æ°á»£c thá»±c hiá»‡n hoÃ n toÃ n hoáº·c khÃ´ng thá»±c hiá»‡n gÃ¬.</li><li><b>Consistency (TÃ­nh nháº¥t quÃ¡n):</b> CSDL luÃ´n chuyá»ƒn tá»« tráº¡ng thÃ¡i há»£p lá»‡ nÃ y sang tráº¡ng thÃ¡i há»£p lá»‡ khÃ¡c.</li><li><b>Isolation (TÃ­nh cÃ´ láº­p):</b> CÃ¡c giao dá»‹ch Ä‘á»™c láº­p, khÃ´ng áº£nh hÆ°á»Ÿng láº«n nhau.</li><li><b>Durability (TÃ­nh bá»n vá»¯ng):</b> Khi giao dá»‹ch Ä‘Æ°á»£c commit, thay Ä‘á»•i Ä‘Æ°á»£c lÆ°u vÄ©nh viá»…n.</li></ul><hr><h2>3. CÃC Váº¤N Äá»€ TÆ¯Æ NG TRANH (CONCURRENCY PROBLEMS)</h2><p>Khi nhiá»u giao dá»‹ch cháº¡y Ä‘á»“ng thá»i, cÃ³ thá»ƒ xáº£y ra cÃ¡c váº¥n Ä‘á»:</p><ul><li><b>Lost Update (Cáº­p nháº­t máº¥t dá»¯ liá»‡u):</b> Hai giao dá»‹ch ghi Ä‘Ã¨ káº¿t quáº£ cá»§a nhau.</li><li><b>Dirty Read:</b> Giao dá»‹ch Ä‘á»c dá»¯ liá»‡u chÆ°a Ä‘Æ°á»£c commit.</li><li><b>Non-Repeatable Read:</b> Giao dá»‹ch Ä‘á»c cÃ¹ng dá»¯ liá»‡u hai láº§n vÃ  tháº¥y káº¿t quáº£ khÃ¡c nhau.</li><li><b>Phantom Read:</b> Káº¿t quáº£ truy váº¥n khÃ¡c nhau giá»¯a cÃ¡c láº§n Ä‘á»c do báº£n ghi má»›i Ä‘Æ°á»£c chÃ¨n vÃ o.</li></ul><hr><h2>4. CÃC Má»¨C CÃ” Láº¬P (ISOLATION LEVELS)</h2><p>SQL Ä‘á»‹nh nghÄ©a bá»‘n má»©c cÃ´ láº­p, cÃ¢n báº±ng giá»¯a hiá»‡u nÄƒng vÃ  Ä‘á»™ chÃ­nh xÃ¡c:</p><ul><li><b>READ UNCOMMITTED:</b> Cho phÃ©p Ä‘á»c dá»¯ liá»‡u chÆ°a commit â†’ cÃ³ thá»ƒ gÃ¢y dirty read.</li><li><b>READ COMMITTED:</b> Chá»‰ Ä‘á»c dá»¯ liá»‡u Ä‘Ã£ commit â†’ trÃ¡nh dirty read.</li><li><b>REPEATABLE READ:</b> KhÃ´ng cho phÃ©p thay Ä‘á»•i dá»¯ liá»‡u trong suá»‘t giao dá»‹ch â†’ trÃ¡nh non-repeatable read.</li><li><b>SERIALIZABLE:</b> CÃ´ láº­p hoÃ n toÃ n cÃ¡c giao dá»‹ch â†’ an toÃ n nháº¥t nhÆ°ng cháº­m.</li></ul><hr><h2>5. CÆ  CHáº¾ KHÃ“A (LOCKING)</h2><p>DBMS dÃ¹ng khÃ³a Ä‘á»ƒ Ä‘iá»u phá»‘i truy cáº­p dá»¯ liá»‡u Ä‘á»“ng thá»i.</p><ul><li><b>Shared Lock (S):</b> DÃ nh cho thao tÃ¡c Ä‘á»c.</li><li><b>Exclusive Lock (X):</b> DÃ nh cho thao tÃ¡c ghi.</li><li><b>Deadlock:</b> Hai giao dá»‹ch chá» nhau giáº£i phÃ³ng khÃ³a â†’ há»‡ thá»‘ng pháº£i phÃ¡t hiá»‡n vÃ  rollback má»™t giao dá»‹ch.</li></ul><pre><code>BEGIN TRAN;<br>UPDATE SanPham SET SoLuong = SoLuong - 1 WHERE MaSP = 'SP01';<br>WAITFOR DELAY '00:00:10';<br>UPDATE Kho SET SoLuong = SoLuong - 1 WHERE MaSP = 'SP01';<br>COMMIT;</code></pre><hr><h2>6. ÄIá»€U KHIá»‚N TÆ¯Æ NG TRANH (CONCURRENCY CONTROL)</h2><ul><li><b>KhÃ³a hai pha (Two-Phase Locking â€“ 2PL):</b> Giao dá»‹ch gá»“m hai giai Ä‘oáº¡n: cáº¥p khÃ³a vÃ  giáº£i khÃ³a. Äáº£m báº£o tÃ­nh tuáº§n tá»± hÃ³a.</li><li><b>Timestamp Ordering:</b> Sá»­ dá»¥ng dáº¥u thá»i gian Ä‘á»ƒ sáº¯p xáº¿p thá»© tá»± truy cáº­p dá»¯ liá»‡u.</li><li><b>Optimistic Concurrency Control:</b> KhÃ´ng khÃ³a dá»¯ liá»‡u mÃ  kiá»ƒm tra xung Ä‘á»™t khi commit.</li></ul><hr><h2>7. KIá»‚M SOÃT Há»’I PHá»¤C (RECOVERY CONTROL)</h2><p>Há»‡ thá»‘ng lÆ°u log Ä‘á»ƒ khÃ´i phá»¥c dá»¯ liá»‡u khi sá»± cá»‘:</p><ul><li><b>Undo log:</b> HoÃ n tÃ¡c giao dá»‹ch chÆ°a hoÃ n táº¥t.</li><li><b>Redo log:</b> Ghi láº¡i thay Ä‘á»•i Ä‘á»ƒ khÃ´i phá»¥c dá»¯ liá»‡u Ä‘Ã£ commit.</li></ul><hr><h2>âœ… Tá»”NG Káº¾T</h2><ul><li>Giao dá»‹ch Ä‘áº£m báº£o dá»¯ liá»‡u nháº¥t quÃ¡n vÃ  an toÃ n khi nhiá»u ngÆ°á»i thao tÃ¡c Ä‘á»“ng thá»i.</li><li>ACID lÃ  tiÃªu chuáº©n vÃ ng Ä‘á»ƒ Ä‘Ã¡nh giÃ¡ Ä‘á»™ tin cáº­y cá»§a giao dá»‹ch.</li><li>Hiá»ƒu rÃµ cÆ¡ cháº¿ khÃ³a vÃ  kiá»ƒm soÃ¡t tÆ°Æ¡ng tranh giÃºp tá»‘i Æ°u hiá»‡u nÄƒng vÃ  giáº£m rá»§i ro xung Ä‘á»™t dá»¯ liá»‡u.</li></ul>