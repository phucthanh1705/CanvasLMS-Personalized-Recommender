<h1>ğŸ§© BÃ€I 05 â€“ XÃ‚Y Dá»°NG CHá»¨C NÄ‚NG XÃC THá»°C VÃ€ PHÃ‚N QUYá»€N NGÆ¯á»œI DÃ™NG (SPRING SECURITY)</h1>

<h2>ğŸ¯ Má»¥c tiÃªu há»c táº­p</h2>
<ul>
 <li>Hiá»ƒu cÆ¡ cháº¿ xÃ¡c thá»±c (Authentication) vÃ  phÃ¢n quyá»n (Authorization) trong Spring Security.</li>
 <li>Cáº¥u hÃ¬nh báº£o máº­t cÆ¡ báº£n cho á»©ng dá»¥ng web.</li>
 <li>Triá»ƒn khai chá»©c nÄƒng Ä‘Äƒng nháº­p, Ä‘Äƒng kÃ½, vÃ  mÃ£ hÃ³a máº­t kháº©u.</li>
 <li>PhÃ¢n quyá»n theo vai trÃ² ngÆ°á»i dÃ¹ng (User / Admin).</li>
</ul>
<hr>

<h2>1. Giá»›i thiá»‡u Spring Security</h2>
<p><b>Spring Security</b> lÃ  module báº£o máº­t máº¡nh máº½ cho á»©ng dá»¥ng Java, cung cáº¥p cÆ¡ cháº¿ kiá»ƒm soÃ¡t truy cáº­p, xÃ¡c thá»±c ngÆ°á»i dÃ¹ng, vÃ  báº£o vá»‡ CSRF.</p>
<ul>
 <li>Há»— trá»£ xÃ¡c thá»±c qua form login, token, OAuth2.</li>
 <li>TÃ­ch há»£p sáºµn vá»›i Spring Boot thÃ´ng qua dependency <code>spring-boot-starter-security</code>.</li>
</ul>
<hr>

<h2>2. Cáº¥u hÃ¬nh Spring Security cÆ¡ báº£n</h2>
<p>ThÃªm dependency vÃ o <code>pom.xml</code>:</p>
<pre><code>&lt;dependency&gt;
 &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
 &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
<p>Táº¡o class <b>SecurityConfig.java</b>:</p>
<pre><code>@Configuration
@EnableWebSecurity
public class SecurityConfig {

 @Bean
 public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
 http
 .authorizeHttpRequests(auth -&gt; auth
 .requestMatchers("/admin/**").hasRole("ADMIN")
 .requestMatchers("/user/**").hasAnyRole("USER","ADMIN")
 .requestMatchers("/register", "/css/**").permitAll()
 .anyRequest().authenticated()
 )
 .formLogin(form -&gt; form
 .loginPage("/login")
 .defaultSuccessUrl("/home", true)
 .permitAll())
 .logout(logout -&gt; logout.permitAll());
 return http.build();
 }
}</code></pre>
<p>âœ… Máº·c Ä‘á»‹nh Spring Security tá»± Ä‘á»™ng báº£o vá»‡ táº¥t cáº£ route chÆ°a cáº¥u hÃ¬nh báº±ng login form.</p>
<hr>

<h2>3. Táº¡o Entity vÃ  Repository cho ngÆ°á»i dÃ¹ng</h2>
<pre><code>@Entity
@Table(name = "users")
public class User {
 @Id
 @GeneratedValue(strategy = GenerationType.IDENTITY)
 private Long id;
 private String username;
 private String password;
 private String role; // ROLE_USER hoáº·c ROLE_ADMIN
}

@Repository
public interface UserRepository extends JpaRepository&lt;User, Long&gt; {
 Optional&lt;User&gt; findByUsername(String username);
}</code></pre>
<hr>

<h2>4. MÃ£ hÃ³a máº­t kháº©u</h2>
<p>Spring Security sá»­ dá»¥ng <code>BCryptPasswordEncoder</code> Ä‘á»ƒ mÃ£ hÃ³a máº­t kháº©u.</p>
<pre><code>@Bean
public PasswordEncoder passwordEncoder() {
 return new BCryptPasswordEncoder();
}</code></pre>
<p>Khi ngÆ°á»i dÃ¹ng Ä‘Äƒng kÃ½:</p>
<pre><code>@Service
public class UserService {
 @Autowired private UserRepository repo;
 @Autowired private PasswordEncoder encoder;

 public void register(User user) {
 user.setPassword(encoder.encode(user.getPassword()));
 user.setRole("ROLE_USER");
 repo.save(user);
 }
}</code></pre>
<hr>

<h2>5. Cáº¥u hÃ¬nh Custom UserDetailsService</h2>
<pre><code>@Service
public class CustomUserDetailsService implements UserDetailsService {

 @Autowired private UserRepository repo;

 @Override
 public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {
 User user = repo.findByUsername(username)
 .orElseThrow(() -&gt; new UsernameNotFoundException("User not found"));
 return org.springframework.security.core.userdetails.User
 .withUsername(user.getUsername())
 .password(user.getPassword())
 .roles(user.getRole().replace("ROLE_", ""))
 .build();
 }
}</code></pre>
<hr>

<h2>6. Táº¡o form Ä‘Äƒng nháº­p vÃ  Ä‘Äƒng kÃ½</h2>
<p><b>login.html</b>:</p>
<pre><code>
 <h3>ÄÄƒng nháº­p</h3>
 <br>
 <br>
 ÄÄƒng nháº­p
</code></pre>
<p><b>register.html</b>:</p>
<pre><code>
 <h3>ÄÄƒng kÃ½ tÃ i khoáº£n</h3>
 <br>
 <br>
 ÄÄƒng kÃ½
</code></pre>
<hr>

<h2>7. PhÃ¢n quyá»n route vÃ  xá»­ lÃ½ truy cáº­p</h2>
<p>VÃ­ dá»¥ route <code>/admin/**</code> chá»‰ truy cáº­p Ä‘Æ°á»£c vá»›i role <b>ADMIN</b>, cÃ²n route <code>/user/**</code> cho phÃ©p USER vÃ  ADMIN.</p>
<p>ThÃªm @PreAuthorize cho cÃ¡c phÆ°Æ¡ng thá»©c quan trá»ng:</p>
<pre><code>@Service
public class ProductService {
 @PreAuthorize("hasRole('ADMIN')")
 public void deleteProduct(Long id) { ... }
}</code></pre>
<hr>

<h2>8. CSRF Protection</h2>
<p>Spring Security báº­t CSRF máº·c Ä‘á»‹nh Ä‘á»ƒ trÃ¡nh táº¥n cÃ´ng giáº£ máº¡o request.</p>
<p>Náº¿u báº¡n muá»‘n test REST API, cÃ³ thá»ƒ táº¡m táº¯t:</p>
<pre><code>http.csrf().disable();</code></pre>
<hr>

<h2>9. Kiá»ƒm tra báº£o máº­t vÃ  Ä‘Äƒng xuáº¥t</h2>
<ul>
 <li>Truy cáº­p <code>/login</code> Ä‘á»ƒ Ä‘Äƒng nháº­p.</li>
 <li>Sau khi Ä‘Äƒng nháº­p thÃ nh cÃ´ng, chuyá»ƒn Ä‘áº¿n <code>/home</code>.</li>
 <li>Truy cáº­p <code>/admin/**</code> náº¿u cÃ³ quyá»n ADMIN.</li>
 <li>ÄÄƒng xuáº¥t báº±ng <code>/logout</code>.</li>
</ul>
<hr>

<h2>âœ… Tá»•ng káº¿t</h2>
<ul>
 <li>Spring Security giÃºp xÃ¡c thá»±c vÃ  phÃ¢n quyá»n ngÆ°á»i dÃ¹ng toÃ n diá»‡n.</li>
 <li>Sá»­ dá»¥ng <b>BCryptPasswordEncoder</b> Ä‘á»ƒ Ä‘áº£m báº£o an toÃ n máº­t kháº©u.</li>
 <li>FilterChain vÃ  UserDetailsService lÃ  hai thÃ nh pháº§n cá»‘t lÃµi trong xÃ¡c thá»±c.</li>
 <li>PhÃ¢n quyá»n báº±ng annotation @PreAuthorize hoáº·c cáº¥u hÃ¬nh HttpSecurity.</li>
</ul>