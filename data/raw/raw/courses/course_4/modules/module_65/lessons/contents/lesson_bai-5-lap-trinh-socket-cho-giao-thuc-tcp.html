<h1>ğŸ”Œ BÃ€I 5 â€“ Láº¬P TRÃŒNH SOCKET CHO GIAO THá»¨C TCP</h1><h2>5.1 MÃ” HÃŒNH KHÃCH â€“ CHá»¦ (CLIENT/SERVER)</h2><p>Trong mÃ´ hÃ¬nh <b>Client/Server</b>, má»™t mÃ¡y chá»§ (Server) cung cáº¥p dá»‹ch vá»¥ cho nhiá»u mÃ¡y khÃ¡ch (Client). Giao thá»©c TCP (Transmission Control Protocol) Ä‘Æ°á»£c dÃ¹ng phá»• biáº¿n vÃ¬ Ä‘áº£m báº£o <b>truyá»n dá»¯ liá»‡u tin cáº­y, cÃ³ thá»© tá»±, khÃ´ng máº¥t mÃ¡t</b>.</p><p><b>Äáº·c Ä‘iá»ƒm cá»§a TCP:</b></p><ul><li>HÆ°á»›ng káº¿t ná»‘i (connection-oriented)</li><li>Báº£o Ä‘áº£m Ä‘á»™ tin cáº­y (reliable)</li><li>PhÃ¢n máº£nh dá»¯ liá»‡u thÃ nh gÃ³i nhá», sáº¯p xáº¿p Ä‘Ãºng thá»© tá»± khi nháº­n</li></ul><h3>ğŸ” Chu trÃ¬nh hoáº¡t Ä‘á»™ng:</h3><ol><li>Server táº¡o socket láº¯ng nghe (ServerSocket)</li><li>Client gá»­i yÃªu cáº§u káº¿t ná»‘i (Socket)</li><li>Server cháº¥p nháº­n káº¿t ná»‘i</li><li>Hai bÃªn trao Ä‘á»•i dá»¯ liá»‡u qua luá»“ng I/O</li></ol><hr><h2>5.2 MÃ” HÃŒNH TRUYá»€N TIN SOCKET</h2><p>Socket lÃ  Ä‘iá»ƒm cuá»‘i (endpoint) cá»§a má»™t káº¿t ná»‘i máº¡ng giá»¯a hai tiáº¿n trÃ¬nh.</p><p><b>Cáº¥u trÃºc má»™t káº¿t ná»‘i TCP:</b></p><pre><code>Client Socket = (IP_Client, Port_Client)
Server Socket = (IP_Server, Port_Server)</code></pre><p>Má»—i cáº·p Ä‘á»‹a chá»‰ IP vÃ  port xÃ¡c Ä‘á»‹nh má»™t phiÃªn truyá»n thÃ´ng duy nháº¥t.</p><h3>ğŸ“¡ QuÃ¡ trÃ¬nh thiáº¿t láº­p káº¿t ná»‘i TCP (3-Way Handshake):</h3><ol><li>Client gá»­i SYN Ä‘áº¿n Server</li><li>Server tráº£ lá»i SYN-ACK</li><li>Client gá»­i ACK â†’ káº¿t ná»‘i Ä‘Æ°á»£c thiáº¿t láº­p</li></ol><hr><h2>5.3 Lá»šP SOCKET TRONG JAVA</h2><p>Lá»›p <code>Socket</code> thuá»™c gÃ³i <code>java.net</code>, dÃ¹ng Ä‘á»ƒ táº¡o vÃ  quáº£n lÃ½ káº¿t ná»‘i TCP.</p><pre><code>import java.net.*;
import java.io.*;

public class TCPClient {
    public static void main(String[] args) throws Exception {
        Socket socket = new Socket("localhost", 8080);
        PrintWriter out = new PrintWriter(socket.getOutputStream(), true);
        BufferedReader in = new BufferedReader(new InputStreamReader(socket.getInputStream()));
        out.println("Xin chÃ o Server!");
        System.out.println("Pháº£n há»“i: " + in.readLine());
        socket.close();
    }
}</code></pre><p><b>CÃ¡c phÆ°Æ¡ng thá»©c quan trá»ng:</b></p><ul><li><code>getInputStream()</code>: Ä‘á»c dá»¯ liá»‡u tá»« server</li><li><code>getOutputStream()</code>: gá»­i dá»¯ liá»‡u tá»›i server</li><li><code>close()</code>: Ä‘Ã³ng káº¿t ná»‘i</li><li><code>getInetAddress()</code>: láº¥y Ä‘á»‹a chá»‰ server</li></ul><hr><h2>5.4 Lá»šP SERVERSOCKET</h2><p><code>ServerSocket</code> lÃ  lá»›p cho phÃ©p táº¡o socket láº¯ng nghe yÃªu cáº§u tá»« client.</p><pre><code>import java.net.*;
import java.io.*;

public class TCPServer {
    public static void main(String[] args) throws Exception {
        ServerSocket server = new ServerSocket(8080);
        System.out.println("Server Ä‘ang láº¯ng nghe...");
        Socket socket = server.accept(); // Chá» client káº¿t ná»‘i
        BufferedReader in = new BufferedReader(new InputStreamReader(socket.getInputStream()));
        PrintWriter out = new PrintWriter(socket.getOutputStream(), true);
        String msg = in.readLine();
        System.out.println("Client: " + msg);
        out.println("ChÃ o client, tÃ´i lÃ  server!");
        socket.close();
        server.close();
    }
}</code></pre><p><b>PhÆ°Æ¡ng thá»©c chÃ­nh:</b></p><ul><li><code>accept()</code>: chá» káº¿t ná»‘i tá»« client.</li><li><code>close()</code>: Ä‘Ã³ng socket server.</li><li><code>getLocalPort()</code>: láº¥y port mÃ  server Ä‘ang láº¯ng nghe.</li></ul><p>Má»—i khi client káº¿t ná»‘i, Server táº¡o má»™t <code>Socket</code> má»›i Ä‘á»ƒ trao Ä‘á»•i dá»¯ liá»‡u riÃªng biá»‡t.</p><hr><h2>5.5 VÃ Dá»¤ HOÃ€N CHá»ˆNH</h2><h3>Server Ä‘a luá»“ng</h3><pre><code>class ClientHandler extends Thread {
    private Socket socket;
    public ClientHandler(Socket s) { this.socket = s; }
    public void run() {
        try {
            BufferedReader in = new BufferedReader(new InputStreamReader(socket.getInputStream()));
            PrintWriter out = new PrintWriter(socket.getOutputStream(), true);
            String msg = in.readLine();
            System.out.println("Client gá»­i: " + msg);
            out.println("Server nháº­n: " + msg.toUpperCase());
            socket.close();
        } catch(Exception e) { e.printStackTrace(); }
    }
}

public class MultiServer {
    public static void main(String[] args) throws Exception {
        ServerSocket server = new ServerSocket(8080);
        System.out.println("Server cháº¡y cá»•ng 8080");
        while(true) {
            Socket s = server.accept();
            new ClientHandler(s).start();
        }
    }
}</code></pre><p>âœ… <b>Æ¯u Ä‘iá»ƒm cá»§a mÃ´ hÃ¬nh Ä‘a luá»“ng:</b></p><ul><li>Há»— trá»£ nhiá»u client cÃ¹ng lÃºc.</li><li>KhÃ´ng cháº·n (blocking) server chÃ­nh.</li></ul><hr><h2>âœ… Tá»”NG Káº¾T</h2><ul><li>TCP Ä‘áº£m báº£o truyá»n dá»¯ liá»‡u tin cáº­y vÃ  cÃ³ thá»© tá»±.</li><li>Lá»›p <code>Socket</code> dÃ¹ng cho client, <code>ServerSocket</code> cho server.</li><li>Dá»¯ liá»‡u Ä‘Æ°á»£c gá»­i/nháº­n qua luá»“ng <code>InputStream</code> vÃ  <code>OutputStream</code>.</li><li>Hiá»ƒu mÃ´ hÃ¬nh Client/Server lÃ  ná»n táº£ng Ä‘á»ƒ xÃ¢y dá»±ng á»©ng dá»¥ng máº¡ng thá»±c táº¿.</li></ul>