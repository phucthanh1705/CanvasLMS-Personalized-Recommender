<h1>üìô B√ÄI 8 ‚Äì H√ÄM (FUNCTION)</h1><h2>üéØ M·ª•c ti√™u h·ªçc t·∫≠p</h2><ul><li>Hi·ªÉu r√µ kh√°i ni·ªám v√† vai tr√≤ c·ªßa h√†m ng∆∞·ªùi d√πng ƒë·ªãnh nghƒ©a (User-Defined Function ‚Äì UDF) trong c∆° s·ªü d·ªØ li·ªáu.</li><li>Ph√¢n bi·ªát c√°c lo·∫°i h√†m: Scalar Function, Inline Table Function v√† Multi-Statement Table Function.</li><li>Bi·∫øt c√°ch t·∫°o, s·ª≠ d·ª•ng, s·ª≠a ƒë·ªïi v√† x√≥a h√†m trong SQL Server.</li><li>·ª®ng d·ª•ng h√†m ƒë·ªÉ t√°i s·ª≠ d·ª•ng logic x·ª≠ l√Ω v√† tƒÉng t√≠nh b·∫£o tr√¨ c·ªßa h·ªá th·ªëng.</li></ul><hr><h2>8.1 KH√ÅI NI·ªÜM V·ªÄ FUNCTION</h2><p><b>Function</b> l√† m·ªôt kh·ªëi l·ªánh SQL ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a s·∫µn, c√≥ th·ªÉ nh·∫≠n ƒë·∫ßu v√†o v√† tr·∫£ v·ªÅ m·ªôt gi√° tr·ªã ho·∫∑c m·ªôt b·∫£ng d·ªØ li·ªáu. Function th∆∞·ªùng d√πng ƒë·ªÉ x·ª≠ l√Ω t√≠nh to√°n, ki·ªÉm tra ƒëi·ªÅu ki·ªán ho·∫∑c t√°ch logic nghi·ªáp v·ª• ra kh·ªèi c√¢u truy v·∫•n ch√≠nh.</p><hr><h2>8.2 PH√ÇN LO·∫†I H√ÄM</h2><h3>8.2.1 H√†m v√¥ h∆∞·ªõng (Scalar Function)</h3><p>Tr·∫£ v·ªÅ m·ªôt gi√° tr·ªã ƒë∆°n (s·ªë, chu·ªói, ng√†y th√°ng, v.v).</p><p><b>V√≠ d·ª•:</b></p><pre>CREATE FUNCTION fn_TinhTuoi(@NgaySinh DATE)<br>RETURNS INT<br>AS<br>BEGIN<br>RETURN DATEDIFF(YEAR, @NgaySinh, GETDATE());<br>END;</pre><h3>8.2.2 H√†m b·∫£ng ƒë∆°n (Inline Table-Valued Function)</h3><p>Tr·∫£ v·ªÅ m·ªôt b·∫£ng d·ªØ li·ªáu ƒë∆∞·ª£c x√°c ƒë·ªãnh b·ªüi c√¢u l·ªánh SELECT duy nh·∫•t.</p><p><b>V√≠ d·ª•:</b></p><pre>CREATE FUNCTION fn_SV_DiemCao(@DiemMin FLOAT)<br>RETURNS TABLE<br>AS<br>RETURN (SELECT MaSV, MaMon, Diem FROM KetQua WHERE Diem &gt;= @DiemMin);</pre><h3>8.2.3 H√†m b·∫£ng ƒëa l·ªánh (Multi-Statement Table Function)</h3><p>Tr·∫£ v·ªÅ b·∫£ng ƒë∆∞·ª£c x√¢y d·ª±ng th√¥ng qua nhi·ªÅu c√¢u l·ªánh x·ª≠ l√Ω b√™n trong th√¢n h√†m.</p><p><b>V√≠ d·ª•:</b></p><pre>CREATE FUNCTION fn_DanhSachMon()<br>RETURNS @Table TABLE(MaMon CHAR(10), TenMon NVARCHAR(100))<br>AS<br>BEGIN<br>INSERT INTO @Table SELECT MaMon, TenMon FROM MonHoc;<br>RETURN;<br>END;</pre><hr><h2>8.3 G·ªåI H√ÄM</h2><ul><li><b>H√†m v√¥ h∆∞·ªõng:</b> SELECT dbo.fn_TinhTuoi('2002-05-10');</li><li><b>H√†m b·∫£ng:</b> SELECT * FROM dbo.fn_SV_DiemCao(8);</li></ul><hr><h2>8.4 C·∫¨P NH·∫¨T, S·ª¨A, V√Ä X√ìA H√ÄM</h2><ul><li><b>S·ª≠a h√†m:</b> ALTER FUNCTION TenHam ...</li><li><b>X√≥a h√†m:</b> DROP FUNCTION TenHam;</li></ul><hr><h2>8.5 SO S√ÅNH FUNCTION V√Ä PROCEDURE</h2><table border="1" cellpadding="5"><tbody><tr><th>Ti√™u ch√≠</th><th>Function</th><th>Procedure</th></tr><tr><td>Gi√° tr·ªã tr·∫£ v·ªÅ</td><td>B·∫Øt bu·ªôc c√≥</td><td>Kh√¥ng b·∫Øt bu·ªôc</td></tr><tr><td>G·ªçi trong SELECT</td><td>C√≥ th·ªÉ</td><td>Kh√¥ng th·ªÉ</td></tr><tr><td>Th·ª±c hi·ªán l·ªánh INSERT/UPDATE/DELETE</td><td>Kh√¥ng n√™n</td><td>ƒê∆∞·ª£c ph√©p</td></tr><tr><td>·ª®ng d·ª•ng</td><td>T√≠nh to√°n, ki·ªÉm tra ƒëi·ªÅu ki·ªán</td><td>T·ª± ƒë·ªông h√≥a nghi·ªáp v·ª•</td></tr></tbody></table><hr><h2>8.6 ·ª®NG D·ª§NG FUNCTION</h2><ul><li>T√≠nh to√°n ƒë·ªông trong truy v·∫•n (nh∆∞ t·ªïng, ƒëi·ªÉm trung b√¨nh,...).</li><li>T·∫°o c√°c h√†m ti·ªán √≠ch chu·∫©n cho to√†n b·ªô h·ªá th·ªëng.</li><li>Gi·∫£m l·∫∑p l·∫°i m√£ ngu·ªìn SQL v√† tƒÉng kh·∫£ nƒÉng b·∫£o tr√¨.</li><li>D·ªÖ d√†ng t√°i s·ª≠ d·ª•ng trong nhi·ªÅu View, Procedure ho·∫∑c Trigger.</li></ul><hr><h2>8.7 H√ÄM H·ªÜ TH·ªêNG TH√îNG D·ª§NG</h2><ul><li><b>GETDATE():</b> L·∫•y ng√†y gi·ªù hi·ªán t·∫°i.</li><li><b>LEN(), LOWER(), UPPER():</b> X·ª≠ l√Ω chu·ªói.</li><li><b>ISNULL(), COALESCE():</b> Ki·ªÉm tra gi√° tr·ªã NULL.</li><li><b>ABS(), ROUND(), POWER():</b> X·ª≠ l√Ω s·ªë h·ªçc.</li></ul><hr><h2>‚úÖ Ghi nh·ªõ nhanh</h2><ul><li>Function c√≥ th·ªÉ tr·∫£ v·ªÅ m·ªôt gi√° tr·ªã ho·∫∑c m·ªôt b·∫£ng.</li><li>H√†m kh√¥ng ƒë∆∞·ª£c ph√©p thay ƒë·ªïi d·ªØ li·ªáu g·ªëc.</li><li>C√≥ th·ªÉ g·ªçi h√†m trong SELECT, WHERE ho·∫∑c JOIN.</li><li>H√†m gi√∫p t√°i s·ª≠ d·ª•ng logic v√† tƒÉng b·∫£o tr√¨ h·ªá th·ªëng.</li></ul>