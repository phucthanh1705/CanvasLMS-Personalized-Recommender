{
  "id": "lesson_bai-05-xay-dung-chuc-nang-xac-thuc-va-phan-quyen-nguoi-dung",
  "title": "lesson_bai-05-xay-dung-chuc-nang-xac-thuc-va-phan-quyen-nguoi-dung",
  "body": "<h1>üß© B√ÄI 05 ‚Äì X√ÇY D·ª∞NG CH·ª®C NƒÇNG X√ÅC TH·ª∞C V√Ä PH√ÇN QUY·ªÄN NG∆Ø·ªúI D√ôNG (SPRING SECURITY)</h1>\n\n<h2>üéØ M·ª•c ti√™u h·ªçc t·∫≠p</h2>\n<ul>\n <li>Hi·ªÉu c∆° ch·∫ø x√°c th·ª±c (Authentication) v√† ph√¢n quy·ªÅn (Authorization) trong Spring Security.</li>\n <li>C·∫•u h√¨nh b·∫£o m·∫≠t c∆° b·∫£n cho ·ª©ng d·ª•ng web.</li>\n <li>Tri·ªÉn khai ch·ª©c nƒÉng ƒëƒÉng nh·∫≠p, ƒëƒÉng k√Ω, v√† m√£ h√≥a m·∫≠t kh·∫©u.</li>\n <li>Ph√¢n quy·ªÅn theo vai tr√≤ ng∆∞·ªùi d√πng (User / Admin).</li>\n</ul>\n<hr>\n\n<h2>1. Gi·ªõi thi·ªáu Spring Security</h2>\n<p><b>Spring Security</b> l√† module b·∫£o m·∫≠t m·∫°nh m·∫Ω cho ·ª©ng d·ª•ng Java, cung c·∫•p c∆° ch·∫ø ki·ªÉm so√°t truy c·∫≠p, x√°c th·ª±c ng∆∞·ªùi d√πng, v√† b·∫£o v·ªá CSRF.</p>\n<ul>\n <li>H·ªó tr·ª£ x√°c th·ª±c qua form login, token, OAuth2.</li>\n <li>T√≠ch h·ª£p s·∫µn v·ªõi Spring Boot th√¥ng qua dependency <code>spring-boot-starter-security</code>.</li>\n</ul>\n<hr>\n\n<h2>2. C·∫•u h√¨nh Spring Security c∆° b·∫£n</h2>\n<p>Th√™m dependency v√†o <code>pom.xml</code>:</p>\n<pre><code>&lt;dependency&gt;\n &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;\n&lt;/dependency&gt;</code></pre>\n<p>T·∫°o class <b>SecurityConfig.java</b>:</p>\n<pre><code>@Configuration\n@EnableWebSecurity\npublic class SecurityConfig {\n\n @Bean\n public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {\n http\n .authorizeHttpRequests(auth -&gt; auth\n .requestMatchers(\"/admin/**\").hasRole(\"ADMIN\")\n .requestMatchers(\"/user/**\").hasAnyRole(\"USER\",\"ADMIN\")\n .requestMatchers(\"/register\", \"/css/**\").permitAll()\n .anyRequest().authenticated()\n )\n .formLogin(form -&gt; form\n .loginPage(\"/login\")\n .defaultSuccessUrl(\"/home\", true)\n .permitAll())\n .logout(logout -&gt; logout.permitAll());\n return http.build();\n }\n}</code></pre>\n<p>‚úÖ M·∫∑c ƒë·ªãnh Spring Security t·ª± ƒë·ªông b·∫£o v·ªá t·∫•t c·∫£ route ch∆∞a c·∫•u h√¨nh b·∫±ng login form.</p>\n<hr>\n\n<h2>3. T·∫°o Entity v√† Repository cho ng∆∞·ªùi d√πng</h2>\n<pre><code>@Entity\n@Table(name = \"users\")\npublic class User {\n @Id\n @GeneratedValue(strategy = GenerationType.IDENTITY)\n private Long id;\n private String username;\n private String password;\n private String role; // ROLE_USER ho·∫∑c ROLE_ADMIN\n}\n\n@Repository\npublic interface UserRepository extends JpaRepository&lt;User, Long&gt; {\n Optional&lt;User&gt; findByUsername(String username);\n}</code></pre>\n<hr>\n\n<h2>4. M√£ h√≥a m·∫≠t kh·∫©u</h2>\n<p>Spring Security s·ª≠ d·ª•ng <code>BCryptPasswordEncoder</code> ƒë·ªÉ m√£ h√≥a m·∫≠t kh·∫©u.</p>\n<pre><code>@Bean\npublic PasswordEncoder passwordEncoder() {\n return new BCryptPasswordEncoder();\n}</code></pre>\n<p>Khi ng∆∞·ªùi d√πng ƒëƒÉng k√Ω:</p>\n<pre><code>@Service\npublic class UserService {\n @Autowired private UserRepository repo;\n @Autowired private PasswordEncoder encoder;\n\n public void register(User user) {\n user.setPassword(encoder.encode(user.getPassword()));\n user.setRole(\"ROLE_USER\");\n repo.save(user);\n }\n}</code></pre>\n<hr>\n\n<h2>5. C·∫•u h√¨nh Custom UserDetailsService</h2>\n<pre><code>@Service\npublic class CustomUserDetailsService implements UserDetailsService {\n\n @Autowired private UserRepository repo;\n\n @Override\n public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {\n User user = repo.findByUsername(username)\n .orElseThrow(() -&gt; new UsernameNotFoundException(\"User not found\"));\n return org.springframework.security.core.userdetails.User\n .withUsername(user.getUsername())\n .password(user.getPassword())\n .roles(user.getRole().replace(\"ROLE_\", \"\"))\n .build();\n }\n}</code></pre>\n<hr>\n\n<h2>6. T·∫°o form ƒëƒÉng nh·∫≠p v√† ƒëƒÉng k√Ω</h2>\n<p><b>login.html</b>:</p>\n<pre><code>\n <h3>ƒêƒÉng nh·∫≠p</h3>\n <br>\n <br>\n ƒêƒÉng nh·∫≠p\n</code></pre>\n<p><b>register.html</b>:</p>\n<pre><code>\n <h3>ƒêƒÉng k√Ω t√†i kho·∫£n</h3>\n <br>\n <br>\n ƒêƒÉng k√Ω\n</code></pre>\n<hr>\n\n<h2>7. Ph√¢n quy·ªÅn route v√† x·ª≠ l√Ω truy c·∫≠p</h2>\n<p>V√≠ d·ª• route <code>/admin/**</code> ch·ªâ truy c·∫≠p ƒë∆∞·ª£c v·ªõi role <b>ADMIN</b>, c√≤n route <code>/user/**</code> cho ph√©p USER v√† ADMIN.</p>\n<p>Th√™m @PreAuthorize cho c√°c ph∆∞∆°ng th·ª©c quan tr·ªçng:</p>\n<pre><code>@Service\npublic class ProductService {\n @PreAuthorize(\"hasRole('ADMIN')\")\n public void deleteProduct(Long id) { ... }\n}</code></pre>\n<hr>\n\n<h2>8. CSRF Protection</h2>\n<p>Spring Security b·∫≠t CSRF m·∫∑c ƒë·ªãnh ƒë·ªÉ tr√°nh t·∫•n c√¥ng gi·∫£ m·∫°o request.</p>\n<p>N·∫øu b·∫°n mu·ªën test REST API, c√≥ th·ªÉ t·∫°m t·∫Øt:</p>\n<pre><code>http.csrf().disable();</code></pre>\n<hr>\n\n<h2>9. Ki·ªÉm tra b·∫£o m·∫≠t v√† ƒëƒÉng xu·∫•t</h2>\n<ul>\n <li>Truy c·∫≠p <code>/login</code> ƒë·ªÉ ƒëƒÉng nh·∫≠p.</li>\n <li>Sau khi ƒëƒÉng nh·∫≠p th√†nh c√¥ng, chuy·ªÉn ƒë·∫øn <code>/home</code>.</li>\n <li>Truy c·∫≠p <code>/admin/**</code> n·∫øu c√≥ quy·ªÅn ADMIN.</li>\n <li>ƒêƒÉng xu·∫•t b·∫±ng <code>/logout</code>.</li>\n</ul>\n<hr>\n\n<h2>‚úÖ T·ªïng k·∫øt</h2>\n<ul>\n <li>Spring Security gi√∫p x√°c th·ª±c v√† ph√¢n quy·ªÅn ng∆∞·ªùi d√πng to√†n di·ªán.</li>\n <li>S·ª≠ d·ª•ng <b>BCryptPasswordEncoder</b> ƒë·ªÉ ƒë·∫£m b·∫£o an to√†n m·∫≠t kh·∫©u.</li>\n <li>FilterChain v√† UserDetailsService l√† hai th√†nh ph·∫ßn c·ªët l√µi trong x√°c th·ª±c.</li>\n <li>Ph√¢n quy·ªÅn b·∫±ng annotation @PreAuthorize ho·∫∑c c·∫•u h√¨nh HttpSecurity.</li>\n</ul>",
  "updated_at": null
}