{
  "id": "lesson_bai-10-quan-lu-trang-thai-session-and-cookie-trong-asp-dot-net-core-mvc",
  "title": "lesson_bai-10-quan-lu-trang-thai-session-and-cookie-trong-asp-dot-net-core-mvc",
  "body": "<h1>ğŸ§© BÃ€I 10 â€“ QUáº¢N LÃ TRáº NG THÃI (SESSION &amp; COOKIE) TRONG ASP.NET CORE MVC</h1><h2>ğŸ¯ Má»¥c tiÃªu há»c táº­p</h2><ul><li>Hiá»ƒu khÃ¡i niá»‡m quáº£n lÃ½ tráº¡ng thÃ¡i (State Management) trong á»©ng dá»¥ng web.</li><li>PhÃ¢n biá»‡t giá»¯a Session, Cookie vÃ  TempData.</li><li>Biáº¿t cÃ¡ch lÆ°u, Ä‘á»c, xÃ³a dá»¯ liá»‡u Session vÃ  Cookie trong ASP.NET Core.</li><li>Thá»±c hÃ nh á»©ng dá»¥ng: giá» hÃ ng, lÆ°u Ä‘Äƒng nháº­p, thÃ´ng bÃ¡o ngÆ°á»i dÃ¹ng.</li></ul><hr><h2>1. Táº¡i sao cáº§n quáº£n lÃ½ tráº¡ng thÃ¡i?</h2><p>HTTP lÃ  giao thá»©c <b>stateless</b> â€“ má»—i request Ä‘á»™c láº­p, khÃ´ng nhá»› dá»¯ liá»‡u trÆ°á»›c Ä‘Ã³. â†’ VÃ¬ váº­y cáº§n cÆ¡ cháº¿ <b>lÆ°u táº¡m</b> Ä‘á»ƒ biáº¿t ngÆ°á»i dÃ¹ng lÃ  ai, Ä‘Ã£ Ä‘Äƒng nháº­p hay chÆ°a, Ä‘ang chá»n sáº£n pháº©m nÃ o, v.v.</p><p>CÃ¡c cÆ¡ cháº¿ quáº£n lÃ½ tráº¡ng thÃ¡i:</p><ul><li><b>Session</b> â€“ lÆ°u táº¡m dá»¯ liá»‡u phÃ­a server (cho tá»«ng ngÆ°á»i dÃ¹ng).</li><li><b>Cookie</b> â€“ lÆ°u thÃ´ng tin nhá» á»Ÿ trÃ¬nh duyá»‡t client.</li><li><b>TempData</b> â€“ lÆ°u táº¡m giá»¯a 2 request (qua redirect).</li></ul><hr><h2>2. Cáº¥u hÃ¬nh Session trong ASP.NET Core</h2><p>Trong file <code>Program.cs</code> hoáº·c <code>Startup.cs</code>:</p><pre><code>var builder = WebApplication.CreateBuilder(args);builder.Services.AddControllersWithViews();builder.Services.AddSession(); // kÃ­ch hoáº¡t dá»‹ch vá»¥ sessionvar app = builder.Build();app.UseSession(); // báº­t middleware sessionapp.UseRouting();app.UseEndpoints(endpoints =&gt;{    endpoints.MapControllerRoute(        name: \"default\",        pattern: \"{controller=Home}/{action=Index}/{id?}\");});app.Run();</code></pre><hr><h2>3. LÃ m viá»‡c vá»›i Session trong Controller</h2><h3>âœ”ï¸ LÆ°u dá»¯ liá»‡u Session:</h3><pre><code>HttpContext.Session.SetString(\"UserName\", \"NguyenVanA\");HttpContext.Session.SetInt32(\"LoginCount\", 5);</code></pre><h3>âœ”ï¸ Äá»c dá»¯ liá»‡u Session:</h3><pre><code>var name = HttpContext.Session.GetString(\"UserName\");var count = HttpContext.Session.GetInt32(\"LoginCount\");</code></pre><h3>âœ”ï¸ XÃ³a dá»¯ liá»‡u:</h3><pre><code>HttpContext.Session.Remove(\"UserName\");HttpContext.Session.Clear(); // xÃ³a toÃ n bá»™ session</code></pre><p><b>LÆ°u Ã½:</b> Session lÆ°u táº¡m trÃªn server, cÃ³ thá»i gian sá»‘ng máº·c Ä‘á»‹nh ~20 phÃºt.</p><hr><h2>4. Sá»­ dá»¥ng Cookie trong ASP.NET Core</h2><h3>âœ”ï¸ Táº¡o cookie:</h3><pre><code>CookieOptions option = new CookieOptions();option.Expires = DateTime.Now.AddMinutes(30);Response.Cookies.Append(\"UserEmail\", \"abc@gmail.com\", option);</code></pre><h3>âœ”ï¸ Äá»c cookie:</h3><pre><code>string email = Request.Cookies[\"UserEmail\"];</code></pre><h3>âœ”ï¸ XÃ³a cookie:</h3><pre><code>Response.Cookies.Delete(\"UserEmail\");</code></pre><hr><h2>5. So sÃ¡nh Session vÃ  Cookie</h2><table border=\"1\" cellpadding=\"6\" cellspacing=\"0\"><thead><tr><th>TiÃªu chÃ­</th><th>Session</th><th>Cookie</th></tr></thead><tbody><tr><td>NÆ¡i lÆ°u trá»¯</td><td>Server</td><td>Client (trÃ¬nh duyá»‡t)</td></tr><tr><td>Thá»i gian tá»“n táº¡i</td><td>Táº¡m thá»i (20 phÃºt hoáº·c Ä‘áº¿n khi Ä‘Ã³ng trÃ¬nh duyá»‡t)</td><td>TÃ¹y cáº¥u hÃ¬nh (Expires)</td></tr><tr><td>Báº£o máº­t</td><td>Cao hÆ¡n</td><td>Dá»… bá»‹ lá»™ náº¿u khÃ´ng mÃ£ hÃ³a</td></tr><tr><td>KÃ­ch thÆ°á»›c tá»‘i Ä‘a</td><td>KhÃ´ng giá»›i háº¡n (theo RAM)</td><td>~4 KB</td></tr><tr><td>á»¨ng dá»¥ng phá»• biáº¿n</td><td>ÄÄƒng nháº­p, giá» hÃ ng</td><td>Ghi nhá»› Ä‘Äƒng nháº­p, ngÃ´n ngá»¯</td></tr></tbody></table><hr><h2>6. TempData â€“ dá»¯ liá»‡u táº¡m giá»¯a hai request</h2><pre><code>TempData[\"Message\"] = \"ÄÄƒng kÃ½ thÃ nh cÃ´ng!\";return RedirectToAction(\"Success\");</code></pre><p>á» trang Success:</p><pre><code>&lt;div&gt;@TempData[\"Message\"]&lt;/div&gt;</code></pre><p>â†’ <b>TempData</b> lÆ°u qua <b>Session</b> vÃ  bá»‹ xÃ³a sau khi Ä‘á»c.</p><hr><h2>7. VÃ­ dá»¥ á»©ng dá»¥ng thá»±c táº¿ â€“ ÄÄƒng nháº­p ngÆ°á»i dÃ¹ng</h2><pre><code>// Controllerpublic IActionResult Login(string username, string password){    if (username == \"admin\" &amp;&amp; password == \"123\")    {        HttpContext.Session.SetString(\"User\", username);        return RedirectToAction(\"Welcome\");    }    ViewBag.Error = \"Sai tÃ i khoáº£n hoáº·c máº­t kháº©u!\";    return View();}public IActionResult Welcome(){    string user = HttpContext.Session.GetString(\"User\");    return Content($\"Xin chÃ o {user}!\");}</code></pre><hr><h2>8. Báº£o máº­t vÃ  lÆ°u Ã½ khi sá»­ dá»¥ng</h2><ul><li>KhÃ´ng lÆ°u máº­t kháº©u, token hoáº·c thÃ´ng tin nháº¡y cáº£m trong cookie khÃ´ng mÃ£ hÃ³a.</li><li>DÃ¹ng <b>HttpsOnly</b> vÃ  <b>Secure</b> cho cookie khi triá»ƒn khai tháº­t.</li><li>Session nÃªn Ä‘Æ°á»£c dÃ¹ng cho dá»¯ liá»‡u táº¡m, khÃ´ng cho dá»¯ liá»‡u lá»›n.</li><li>Dá»n dáº¹p Session khi ngÆ°á»i dÃ¹ng Ä‘Äƒng xuáº¥t.</li></ul><hr><h2>ğŸ§  BÃ i táº­p thá»±c hÃ nh</h2><ol><li>Táº¡o project ASP.NET Core cÃ³ tÃ­nh nÄƒng Ä‘Äƒng nháº­p Ä‘Æ¡n giáº£n báº±ng Session.</li><li>Táº¡o Cookie ghi nhá»› email Ä‘Äƒng nháº­p trong 30 phÃºt.</li><li>Hiá»ƒn thá»‹ thÃ´ng bÃ¡o thÃ nh cÃ´ng qua TempData sau khi Ä‘Äƒng kÃ½.</li><li>Thá»±c hiá»‡n xÃ³a Session khi ngÆ°á»i dÃ¹ng nháº¥n â€œÄÄƒng xuáº¥tâ€.</li><li>ThÃªm pháº§n hiá»ƒn thá»‹ táº¥t cáº£ cookie hiá»‡n táº¡i trong trang View.</li></ol><hr><h2>âœ… Tá»•ng káº¿t</h2><ul><li>Session, Cookie vÃ  TempData lÃ  3 cÆ¡ cháº¿ chÃ­nh Ä‘á»ƒ lÆ°u tráº¡ng thÃ¡i ngÆ°á»i dÃ¹ng trong ASP.NET Core.</li><li>Hiá»ƒu cÃ¡ch táº¡o, Ä‘á»c, xÃ³a dá»¯ liá»‡u vÃ  á»©ng dá»¥ng trong thá»±c táº¿ (login, giá» hÃ ng,â€¦).</li><li>Äáº·t ná»n táº£ng cho pháº§n <b>Authentication &amp; Authorization</b> trong cÃ¡c module nÃ¢ng cao.</li></ul>",
  "updated_at": null
}