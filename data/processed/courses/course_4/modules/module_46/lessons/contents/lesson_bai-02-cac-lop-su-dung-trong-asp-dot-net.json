{
  "id": "lesson_bai-02-cac-lop-su-dung-trong-asp-dot-net",
  "title": "lesson_bai-02-cac-lop-su-dung-trong-asp-dot-net",
  "body": "<h1>ğŸ§© BÃ€I 02 â€“ CÃC Lá»šP Sá»¬ Dá»¤NG TRONG ASP.NET</h1><h2>ğŸ¯ Má»¥c tiÃªu há»c táº­p</h2><ul><li>Hiá»ƒu rÃµ vai trÃ² cá»§a cÃ¡c Ä‘á»‘i tÆ°á»£ng lÃµi trong ASP.NET: <code>Request</code>, <code>Response</code>, <code>Server</code>, <code>Session</code>, <code>Application</code>, <code>Cookie</code>.</li><li>Náº¯m Ä‘Æ°á»£c cÆ¡ cháº¿ truyá»n dá»¯ liá»‡u giá»¯a client vÃ  server.</li><li>Thá»±c hÃ nh thao tÃ¡c lÆ°u trá»¯, xá»­ lÃ½ vÃ  pháº£n há»“i dá»¯ liá»‡u qua cÃ¡c lá»›p nÃ y.</li></ul><hr><h2>1. Tá»•ng quan vá» cÃ¡c lá»›p Ä‘á»‘i tÆ°á»£ng trong ASP.NET</h2><p>Trong á»©ng dá»¥ng ASP.NET, má»—i trang web Ä‘Æ°á»£c cháº¡y trong má»™t bá»‘i cáº£nh (context) bao gá»“m cÃ¡c Ä‘á»‘i tÆ°á»£ng há»‡ thá»‘ng cho phÃ©p ta truy cáº­p vÃ  xá»­ lÃ½ dá»¯ liá»‡u cá»§a ngÆ°á»i dÃ¹ng.</p><table border=\"1\" cellpadding=\"6\" cellspacing=\"0\"><thead><tr><th>Äá»‘i tÆ°á»£ng</th><th>Chá»©c nÄƒng chÃ­nh</th></tr></thead><tbody><tr><td><b>Request</b></td><td>Äáº¡i diá»‡n cho yÃªu cáº§u HTTP gá»­i tá»« client lÃªn server (bao gá»“m form, query string, cookies, header).</td></tr><tr><td><b>Response</b></td><td>Äáº¡i diá»‡n cho pháº£n há»“i HTTP gá»­i tá»« server vá» client (tráº£ trang HTML, file, cookie, redirect...).</td></tr><tr><td><b>Server</b></td><td>Cung cáº¥p cÃ¡c phÆ°Æ¡ng thá»©c xá»­ lÃ½ phÃ­a server nhÆ° <code>MapPath</code>, <code>HtmlEncode</code>, <code>UrlEncode</code>.</td></tr><tr><td><b>Session</b></td><td>LÆ°u dá»¯ liá»‡u táº¡m thá»i riÃªng biá»‡t cho tá»«ng ngÆ°á»i dÃ¹ng trong phiÃªn lÃ m viá»‡c hiá»‡n táº¡i.</td></tr><tr><td><b>Application</b></td><td>LÆ°u dá»¯ liá»‡u dÃ¹ng chung giá»¯a má»i ngÆ°á»i dÃ¹ng (pháº¡m vi toÃ n á»©ng dá»¥ng).</td></tr><tr><td><b>Cookie</b></td><td>LÆ°u thÃ´ng tin nhá» á»Ÿ phÃ­a client, giÃºp ghi nhá»› tráº¡ng thÃ¡i Ä‘Äƒng nháº­p hoáº·c tÃ¹y chá»n cÃ¡ nhÃ¢n.</td></tr></tbody></table><hr><h2>2. Äá»‘i tÆ°á»£ng Request</h2><p><b>Request</b> chá»©a toÃ n bá»™ dá»¯ liá»‡u mÃ  ngÆ°á»i dÃ¹ng gá»­i lÃªn qua form, URL, hoáº·c HTTP header.</p><h3>VÃ­ dá»¥ 1 â€“ Láº¥y dá»¯ liá»‡u tá»« Form</h3><pre><code>string username = Request.Form[\\\"txtUser\\\"];string password = Request.Form[\\\"txtPass\\\"];</code></pre><h3>VÃ­ dá»¥ 2 â€“ Láº¥y dá»¯ liá»‡u tá»« Query String</h3><pre><code>// URL: https://localhost:8080/Home.aspx?name=Thanhstring name = Request.QueryString[\\\"name\\\"];Response.Write($\\\"Xin chÃ o {name}\\\");</code></pre><h3>VÃ­ dá»¥ 3 â€“ Láº¥y Ä‘á»‹a chá»‰ IP vÃ  trÃ¬nh duyá»‡t</h3><pre><code>string ip = Request.UserHostAddress;string browser = Request.Browser.Browser;Response.Write($\\\"TrÃ¬nh duyá»‡t: {browser}, IP: {ip}\\\");</code></pre><hr><h2>3. Äá»‘i tÆ°á»£ng Response</h2><p><b>Response</b> dÃ¹ng Ä‘á»ƒ gá»­i dá»¯ liá»‡u tráº£ vá» client hoáº·c Ä‘iá»u hÆ°á»›ng trang.</p><pre><code>Response.Write(\\\"&lt;h3&gt;Xin chÃ o ASP.NET!&lt;/h3&gt;\\\");Response.Redirect(\\\"Login.aspx\\\"); // chuyá»ƒn hÆ°á»›ng sang trang khÃ¡cResponse.ContentType = \\\"application/json\\\"; // tráº£ dá»¯ liá»‡u JSONResponse.End(); // káº¿t thÃºc pháº£n há»“i</code></pre><h4>ğŸ“˜ á»¨ng dá»¥ng thá»±c táº¿:</h4><p>Táº¡o trang â€œSubmit.aspxâ€ Ä‘á»ƒ hiá»ƒn thá»‹ thÃ´ng tin gá»­i tá»« Form:</p><pre><code>string name = Request.Form[\\\"txtName\\\"];Response.Write($\\\"Cáº£m Æ¡n {name}, dá»¯ liá»‡u cá»§a báº¡n Ä‘Ã£ Ä‘Æ°á»£c ghi nháº­n!\\\");</code></pre><hr><h2>4. Äá»‘i tÆ°á»£ng Server</h2><p><b>Server</b> cung cáº¥p nhiá»u phÆ°Æ¡ng thá»©c há»— trá»£ thao tÃ¡c ná»™i bá»™ trong á»©ng dá»¥ng web.</p><pre><code>string path = Server.MapPath(\\\"~/App_Data/data.txt\\\");Response.Write(path);</code></pre><p>Giáº£i thÃ­ch:</p><ul><li><b>Server.MapPath</b> â€“ chuyá»ƒn Ä‘Æ°á»ng dáº«n áº£o (URL) sang Ä‘Æ°á»ng dáº«n váº­t lÃ½ trong há»‡ thá»‘ng file.</li><li><b>Server.HtmlEncode</b> â€“ mÃ£ hÃ³a chuá»—i HTML trÃ¡nh lá»—i XSS.</li><li><b>Server.UrlEncode</b> â€“ mÃ£ hÃ³a URL an toÃ n cho truyá»n dá»¯ liá»‡u qua query string.</li></ul><pre><code>string text = Server.HtmlEncode(\\\"&lt;b&gt;Hello&lt;/b&gt;\\\");// Káº¿t quáº£: &lt;b&gt;Hello&lt;/b&gt;</code></pre><hr><h2>5. Äá»‘i tÆ°á»£ng Session</h2><p><b>Session</b> dÃ¹ng Ä‘á»ƒ lÆ°u thÃ´ng tin cá»§a ngÆ°á»i dÃ¹ng trong suá»‘t thá»i gian há» hoáº¡t Ä‘á»™ng trÃªn website. Khi Ä‘Ã³ng trÃ¬nh duyá»‡t, session sáº½ bá»‹ há»§y (máº·c Ä‘á»‹nh sau 20 phÃºt khÃ´ng hoáº¡t Ä‘á»™ng).</p><h3>VÃ­ dá»¥ â€“ LÆ°u vÃ  Ä‘á»c Session</h3><pre><code>// LÆ°u thÃ´ng tin ngÆ°á»i dÃ¹ngSession[\\\"user\\\"] = \\\"Nguyá»…n VÄƒn A\\\";// Äá»c dá»¯ liá»‡ustring u = Session[\\\"user\\\"].ToString();Response.Write(\\\"Xin chÃ o: \\\" + u);</code></pre><h3>XÃ³a Session</h3><pre><code>Session.Remove(\\\"user\\\"); // XÃ³a 1 khÃ³aSession.Abandon();       // Há»§y toÃ n bá»™ session</code></pre><h3>Thay Ä‘á»•i thá»i gian timeout</h3><p>Trong <code>Web.config</code>:</p><pre><code>&lt;sessionState timeout=\\\"40\\\" /&gt;  &lt;!-- 40 phÃºt --&gt;</code></pre><hr><h2>6. Äá»‘i tÆ°á»£ng Application</h2><p><b>Application</b> cho phÃ©p chia sáº» dá»¯ liá»‡u giá»¯a táº¥t cáº£ ngÆ°á»i dÃ¹ng trong á»©ng dá»¥ng.</p><p>VÃ­ dá»¥ thÆ°á»ng dÃ¹ng: Ä‘áº¿m sá»‘ ngÆ°á»i Ä‘ang truy cáº­p website.</p><pre><code>void Application_Start(object sender, EventArgs e){    Application[\\\"count\\\"] = 0;}void Session_Start(object sender, EventArgs e){    Application.Lock();    Application[\\\"count\\\"] = (int)Application[\\\"count\\\"] + 1;    Application.UnLock();}</code></pre><p>Trong trang web:</p><pre><code>Response.Write(\\\"Sá»‘ lÆ°á»£t truy cáº­p: \\\" + Application[\\\"count\\\"]);</code></pre><hr><h2>7. Äá»‘i tÆ°á»£ng Cookie</h2><p><b>Cookie</b> giÃºp lÆ°u thÃ´ng tin ngÆ°á»i dÃ¹ng á»Ÿ phÃ­a client (trÃ¬nh duyá»‡t). VÃ­ dá»¥: ghi nhá»› tÃªn Ä‘Äƒng nháº­p, chá»§ Ä‘á» Æ°a thÃ­ch, hoáº·c token xÃ¡c thá»±c.</p><h3>Táº¡o cookie má»›i</h3><pre><code>HttpCookie ck = new HttpCookie(\\\"user\\\", \\\"thanh\\\");ck.Expires = DateTime.Now.AddDays(1);Response.Cookies.Add(ck);</code></pre><h3>Äá»c cookie</h3><pre><code>if (Request.Cookies[\\\"user\\\"] != null){    string name = Request.Cookies[\\\"user\\\"].Value;    Response.Write(\\\"Xin chÃ o \\\" + name);}</code></pre><h3>XÃ³a cookie</h3><pre><code>HttpCookie ck = new HttpCookie(\\\"user\\\");ck.Expires = DateTime.Now.AddDays(-1);Response.Cookies.Add(ck);</code></pre><hr><h2>8. TÃ¬nh huá»‘ng tá»•ng há»£p</h2><p>Trang <code>Login.aspx</code> lÆ°u tÃªn ngÆ°á»i dÃ¹ng báº±ng Cookie vÃ  Session.</p><pre><code>protected void btnLogin_Click(object sender, EventArgs e){    string name = txtName.Text;    Session[\\\"username\\\"] = name;    HttpCookie ck = new HttpCookie(\\\"username\\\", name);    ck.Expires = DateTime.Now.AddHours(2);    Response.Cookies.Add(ck);    Response.Redirect(\\\"Home.aspx\\\");}</code></pre><p>Trong <code>Home.aspx</code>:</p><pre><code>if (Session[\\\"username\\\"] != null)    lblWelcome.Text = \\\"Xin chÃ o, \\\" + Session[\\\"username\\\"].ToString();else    lblWelcome.Text = \\\"KhÃ¡ch truy cáº­p\\\";</code></pre><hr><h2>ğŸ§  BÃ i táº­p thá»±c hÃ nh</h2><ol><li>Táº¡o form nháº­p tÃªn, sau khi Submit hiá»ƒn thá»‹ tÃªn qua <code>Request.Form</code>.</li><li>LÆ°u tÃªn ngÆ°á»i dÃ¹ng vÃ o <code>Session</code> vÃ  <code>Cookie</code>.</li><li>Hiá»ƒn thá»‹ sá»‘ lÆ°á»£t truy cáº­p trang báº±ng <code>Application</code>.</li><li>Sá»­ dá»¥ng <code>Server.MapPath</code> Ä‘á»ƒ ghi dá»¯ liá»‡u form vÃ o file <code>App_Data</code>.</li><li>Viáº¿t chÆ°Æ¡ng trÃ¬nh Ä‘Äƒng nháº­p vÃ  nhá»› tÃ i khoáº£n báº±ng Cookie trong 1 ngÃ y.</li></ol><hr><h2>âœ… Tá»•ng káº¿t</h2><ul><li>Hiá»ƒu cÆ¡ cháº¿ hoáº¡t Ä‘á»™ng cá»§a <strong>Request â€“ Response â€“ Server â€“ Session â€“ Application â€“ Cookie</strong>.</li><li>PhÃ¢n biá»‡t Ä‘Æ°á»£c pháº¡m vi lÆ°u trá»¯: <code>Session</code> (tá»«ng ngÆ°á»i dÃ¹ng), <code>Application</code> (toÃ n há»‡ thá»‘ng), <code>Cookie</code> (client-side).</li><li>Ãp dá»¥ng Ä‘á»ƒ xÃ¢y dá»±ng chá»©c nÄƒng Ä‘Äƒng nháº­p, ghi nhá»› ngÆ°á»i dÃ¹ng vÃ  thá»‘ng kÃª truy cáº­p.</li></ul>",
  "updated_at": null
}