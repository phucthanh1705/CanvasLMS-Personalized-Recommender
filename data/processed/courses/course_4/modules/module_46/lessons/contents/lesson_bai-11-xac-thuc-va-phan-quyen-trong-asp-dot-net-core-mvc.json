{
  "id": "lesson_bai-11-xac-thuc-va-phan-quyen-trong-asp-dot-net-core-mvc",
  "title": "lesson_bai-11-xac-thuc-va-phan-quyen-trong-asp-dot-net-core-mvc",
  "body": "<h1>ğŸ§© BÃ€I 11 â€“ XÃC THá»°C VÃ€ PHÃ‚N QUYá»€N TRONG ASP.NET CORE MVC</h1><h2>ğŸ¯ Má»¥c tiÃªu há»c táº­p</h2><ul><li>Hiá»ƒu khÃ¡i niá»‡m xÃ¡c thá»±c (Authentication) vÃ  phÃ¢n quyá»n (Authorization).</li><li>Biáº¿t cÃ¡ch triá»ƒn khai Ä‘Äƒng nháº­p báº±ng Cookie Authentication.</li><li>Ãp dá»¥ng phÃ¢n quyá»n theo Role vá»›i thuá»™c tÃ­nh <code>[Authorize]</code>.</li><li>Thá»±c hÃ nh táº¡o há»‡ thá»‘ng Ä‘Äƒng nháº­p/Ä‘Äƒng xuáº¥t vÃ  giá»›i háº¡n truy cáº­p trang.</li></ul><hr><h2>1. KhÃ¡i niá»‡m Authentication &amp; Authorization</h2><ul><li><b>Authentication</b> â€“ XÃ¡c thá»±c: kiá»ƒm tra danh tÃ­nh ngÆ°á»i dÃ¹ng (username/password).</li><li><b>Authorization</b> â€“ PhÃ¢n quyá»n: xÃ¡c Ä‘á»‹nh ngÆ°á»i dÃ¹ng Ä‘Æ°á»£c phÃ©p lÃ m gÃ¬ sau khi Ä‘Äƒng nháº­p.</li></ul><p>VÃ­ dá»¥:</p><ul><li>NgÆ°á»i dÃ¹ng <b>admin</b> cÃ³ thá»ƒ truy cáº­p /Admin/Dashboard.</li><li>NgÆ°á»i dÃ¹ng <b>student</b> chá»‰ Ä‘Æ°á»£c xem /Courses.</li></ul><hr><h2>2. Cáº¥u hÃ¬nh Cookie Authentication</h2><pre><code>var builder = WebApplication.CreateBuilder(args);builder.Services.AddAuthentication(\"MyCookieAuth\")    .AddCookie(\"MyCookieAuth\", options =&gt;    {        options.LoginPath = \"/Account/Login\";        options.AccessDeniedPath = \"/Account/AccessDenied\";    });builder.Services.AddAuthorization();builder.Services.AddControllersWithViews();var app = builder.Build();app.UseAuthentication();app.UseAuthorization();app.MapDefaultControllerRoute();app.Run();</code></pre><p>á» Ä‘Ã¢y: <b>LoginPath</b> vÃ  <b>AccessDeniedPath</b> lÃ  Ä‘Æ°á»ng dáº«n cho trang Ä‘Äƒng nháº­p vÃ  khi bá»‹ cháº·n truy cáº­p.</p><hr><h2>3. Táº¡o Controller xá»­ lÃ½ Ä‘Äƒng nháº­p</h2><pre><code>using Microsoft.AspNetCore.Authentication;using Microsoft.AspNetCore.Authentication.Cookies;using System.Security.Claims;public class AccountController : Controller{    [HttpGet]    public IActionResult Login() =&gt; View();    [HttpPost]    public async Task Login(string username, string password)    {        if (username == \"admin\" &amp;&amp; password == \"123\")        {            var claims = new List&lt;Claim&gt;            {                new Claim(ClaimTypes.Name, username),                new Claim(ClaimTypes.Role, \"Admin\")            };            var identity = new ClaimsIdentity(claims, \"MyCookieAuth\");            var principal = new ClaimsPrincipal(identity);            await HttpContext.SignInAsync(\"MyCookieAuth\", principal);            return RedirectToAction(\"Dashboard\", \"Admin\");        }        ViewBag.Error = \"Sai tÃ i khoáº£n hoáº·c máº­t kháº©u!\";        return View();    }    public async Task Logout()    {        await HttpContext.SignOutAsync(\"MyCookieAuth\");        return RedirectToAction(\"Login\");    }}</code></pre><p>Khi ngÆ°á»i dÃ¹ng Ä‘Äƒng nháº­p, ASP.NET Core sáº½ táº¡o cookie lÆ°u danh tÃ­nh (Claims).</p><hr><h2>4. Báº£o vá»‡ trang báº±ng [Authorize]</h2><pre><code>[Authorize]public class AdminController : Controller{    public IActionResult Dashboard()    {        return View();    }}</code></pre><p>â†’ Chá»‰ ngÆ°á»i Ä‘Ã£ Ä‘Äƒng nháº­p má»›i truy cáº­p Ä‘Æ°á»£c.</p><p>CÃ³ thá»ƒ phÃ¢n quyá»n theo Role:</p><pre><code>[Authorize(Roles = \"Admin\")]public IActionResult Dashboard(){    return View();}</code></pre><hr><h2>5. Cho phÃ©p truy cáº­p cÃ´ng khai báº±ng [AllowAnonymous]</h2><pre><code>[AllowAnonymous]public IActionResult Login() =&gt; View();</code></pre><hr><h2>6. Hiá»ƒn thá»‹ thÃ´ng tin ngÆ°á»i dÃ¹ng Ä‘Ã£ Ä‘Äƒng nháº­p</h2><pre><code>@if (User.Identity.IsAuthenticated){    &lt;p&gt;Xin chÃ o, @User.Identity.Name&lt;/p&gt;    &lt;a asp-controller=\"Account\" asp-action=\"Logout\"&gt;ÄÄƒng xuáº¥t&lt;/a&gt;}else{    &lt;a asp-controller=\"Account\" asp-action=\"Login\"&gt;ÄÄƒng nháº­p&lt;/a&gt;}</code></pre><hr><h2>7. PhÃ¢n quyá»n theo Role</h2><pre><code>[Authorize(Roles = \"Admin\")]public IActionResult ManageUsers() =&gt; View();[Authorize(Roles = \"Student\")]public IActionResult MyCourses() =&gt; View();</code></pre><p>Trong khi táº¡o Claims khi Ä‘Äƒng nháº­p, ta cÃ³ thá»ƒ thÃªm nhiá»u Role:</p><pre><code>new Claim(ClaimTypes.Role, \"Admin\");new Claim(ClaimTypes.Role, \"Manager\");</code></pre><hr><h2>8. Xá»­ lÃ½ khi bá»‹ tá»« chá»‘i truy cáº­p</h2><p>Trang bá»‹ tá»« chá»‘i sáº½ Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong <b>options.AccessDeniedPath</b>:</p><pre><code>public IActionResult AccessDenied(){    return View();}</code></pre><hr><h2>9. Triá»ƒn khai thá»±c táº¿</h2><ul><li>âœ… Trang /Admin/Dashboard yÃªu cáº§u Role = Admin.</li><li>âœ… Trang /Courses chá»‰ cáº§n Ä‘Äƒng nháº­p.</li><li>âœ… Trang /Account/Login cÃ´ng khai (AllowAnonymous).</li><li>âœ… Khi Logout, cookie xÃ¡c thá»±c bá»‹ xÃ³a, quay vá» Login.</li></ul><hr><h2>10. Æ¯u Ä‘iá»ƒm cá»§a Authentication báº±ng Cookie</h2><ul><li>Nháº¹, dá»… triá»ƒn khai.</li><li>KhÃ´ng cáº§n database (náº¿u chá»‰ xÃ¡c thá»±c táº¡m).</li><li>Dá»… má»Ÿ rá»™ng sang Identity Framework hoáº·c JWT.</li></ul><hr><h2>ğŸ§  BÃ i táº­p thá»±c hÃ nh</h2><ol><li>Táº¡o Controller <code>AccountController</code> cÃ³ chá»©c nÄƒng Ä‘Äƒng nháº­p vÃ  Ä‘Äƒng xuáº¥t.</li><li>Hiá»ƒn thá»‹ tÃªn ngÆ°á»i dÃ¹ng trong thanh menu sau khi Ä‘Äƒng nháº­p.</li><li>Táº¡o Controller <code>AdminController</code> chá»‰ truy cáº­p khi Role = Admin.</li><li>Thá»­ Ä‘Äƒng nháº­p báº±ng tÃ i khoáº£n khÃ¡c (student) â†’ bá»‹ tá»« chá»‘i truy cáº­p.</li><li>Táº¡o trang <code>AccessDenied.cshtml</code> hiá»ƒn thá»‹ thÃ´ng bÃ¡o lá»—i quyá»n háº¡n.</li></ol><hr><h2>âœ… Tá»•ng káº¿t</h2><ul><li>PhÃ¢n biá»‡t xÃ¡c thá»±c vÃ  phÃ¢n quyá»n trong ASP.NET Core.</li><li>Hiá»ƒu Cookie Authentication vÃ  cÆ¡ cháº¿ ClaimsIdentity.</li><li>Ãp dá»¥ng [Authorize] vÃ  [AllowAnonymous] linh hoáº¡t.</li><li>Äáº·t ná»n táº£ng cho viá»‡c tÃ­ch há»£p ASP.NET Identity vÃ  JWT Token.</li></ul>",
  "updated_at": null
}